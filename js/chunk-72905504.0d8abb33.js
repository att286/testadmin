(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72905504"],{"1e87":function(e,t,i){},"4a10":function(e,t,i){"use strict";i("1e87")},e5d4:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("a-spin",{attrs:{spinning:e.spinning}},[i("a-card",{attrs:{bordered:!1}},[i("div",{staticClass:"table-operator"},[i("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("添加")])],1),e.groupList.length?i("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:null,scroll:{x:e.tableX},showPagination:"auto"},scopedSlots:e._u([{key:"action",fn:function(t,n){return i("span",{},[[2===n.stauts?i("a",{on:{click:function(t){return e.handleDelete(n)}}},[e._v("删除")]):i("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleEdit(n)}}},[e._v("编辑")])]],2)}}],null,!1,4278285013)}):e._e()],1),i("setting-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onEditCancel,ok:e.onEditDone}})],1)],1)},a=[],o=i("5530"),r=(i("159b"),i("d81d"),i("4de4"),i("b0c0"),i("d3b7"),i("7db0"),i("a15b"),i("c1df")),s=i.n(r),d=i("4360"),u=i("4282"),l=i("2af9"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:e.title,width:740,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[i("a-spin",{attrs:{spinning:e.spinning}},[i("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[i("a-form-item",e._b({attrs:{label:"期数"}},"a-form-item",e.formLayout,!1),[e._v(" "+e._s(e.period)+" ")]),i("a-form-item",e._b({attrs:{label:"可诊断会员组"}},"a-form-item",e.formLayout,!1),[i("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["groupIdList",{initialValue:e.model.groupIdList,rules:[{required:!0,message:"必填"}]}],expression:"['groupIdList', { initialValue: model.groupIdList, rules: [{ required: true, message: '必填' }] }]"}],attrs:{mode:"multiple",name:"groupIdList",placeholder:"请选择可诊断会员组","allow-clear":"","show-search":"","option-filter-prop":"children",options:e.model.groupList}})],1),i("a-form-item",e._b({attrs:{label:"起止日期"}},"a-form-item",e.formLayout,!1),[i("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["dateRange",{initialValue:e.model.startTime?[e.model.startTime,e.model.endTime]:[],rules:[{required:!0,message:"必填"}]}],expression:"['dateRange', { initialValue: model.startTime ? [model.startTime, model.endTime]: [], rules: [{ required: true, message: '必填' }] }]"}],ref:"dateRange",staticStyle:{width:"100%"},attrs:{placeholder:["开始时间","结束时间"],mode:["date","date"],format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD","disabled-date":e.disabledDate}})],1),i("a-form-item",e._b({attrs:{label:"上传持仓数量上限",extra:""}},"a-form-item",e.formLayout,!1),[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fundNumLimit",{initialValue:-1==e.model.fundNumLimit?0:e.model.fundNumLimit,rules:[{required:!0,whitespace:!0,type:"integer",transform:e.transformInputNumber,min:1,message:"请输入大于0的整数"}]}],expression:"['fundNumLimit', { initialValue: model.fundNumLimit == -1 ? 0 : model.fundNumLimit, rules: [\n            { required: true, whitespace: true, type:'integer', transform: transformInputNumber, min: 1, message: '请输入大于0的整数' }\n          ] }]"}],attrs:{placeholder:"请输入上传持仓数量上限","allow-clear":""}})],1)],1)],1)],1)},m=[],f=(i("3ca3"),i("ddb0"),[]),h={name:"GroupEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:5}},wrapperCol:{md:{span:18}}},{form:this.$form.createForm(this),spinning:!1,moduleData:[],editType:0,title:"添加",period:0,submitMethod:"",groupList:[],transformInputNumber:function(e){var t=+e;return""===e&&(t=NaN),t}}},created:function(){var e=this;f.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("visible",(function(t,i){t&&("undefined"!==typeof e.model.id?(e.editType=1,e.title="修改基金诊断",e.period=e.model.period,e.submitMethod="updateFundDiagnosisConf"):(e.editType=0,e.title="新增基金诊断",e.period=e.model.lastPeriod+1,e.submitMethod="addFundDiagnosisConf"))}))},mounted:function(){},methods:{initPage:function(){var e=this,t=[];this.spinning=!0,Promise.all(t.map((function(t){return e[t]()}))).then((function(t){e.spinning=!1}))},disabledDate:function(e){return e&&e<s()().startOf("day")},handleSubmit:function(){var e=this;this.form.validateFields((function(t,i){if(!t){var n={fundNumLimit:i.fundNumLimit,groupIdList:i.groupIdList,startTime:i.dateRange[0],endTime:i.dateRange[1]};0===+n.fundNumLimit&&(n.fundNumLimit=-1),0===e.editType?n.period=e.period:n.id=e.model.id;var a=e.submitMethod;e.spinning=!0,u["a"][a](n).then((function(t){e.$message.info("操作成功"),e.$emit("ok")})).catch((function(e){})).finally((function(){e.spinning=!1}))}}))}}},p=h,g=i("2877"),b=Object(g["a"])(p,c,m,!1,null,null,null),v=b.exports,w=i("fd34"),L={name:"FundsSetting",components:{STable:l["c"],SettingEdit:v},data:function(){return this.columns=w["a"],{spinning:!1,modalVisible:!1,confirmLoading:!1,modalData:{},queryParam:{},loadData:this.reqSettingList,selectedRowKeys:[],selectedRows:[],groupData:[],groupList:[],switchIndex:""}},created:function(){var e=this;this.lastPeriod=0,this.$root.eventHub.$on("refreshView",(function(){e.reqGroupData(),e.$refs.table&&e.$refs.table.refresh()})),this.reqGroupData()},beforeRouteLeave:function(e,t,i){this.$root.eventHub.$off("refreshView"),i()},computed:{tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{reqGroupData:function(){var e=this;return d["a"].dispatch("ta/GetGroups",!1).then((function(t){e.groupData=t,e.groupList=t.filter((function(e){return 1===e.isPay})).map((function(e){return{value:e.id,label:e.name}}))})).catch((function(e){}))},reqSettingList:function(e){var t=this,i=Object(o["a"])(Object(o["a"])({},this.queryParam),{},{pageNum:e.pageNo,pageSize:e.pageSize});return u["a"].fundDiagnosisConfList(i).then((function(i){var n=i.result;t.lastPeriod=n.totalPeriod;var a=n.list,o=s()(n.systemTime).valueOf();a.forEach((function(e){e.status=0,s()(e.startTime).valueOf()>o?e.status=1:s()(e.endTime).valueOf()<o&&(e.status=2),e.dateRange=s()(e.startTime).format("YYYY.MM.DD")+"-"+s()(e.endTime).format("YYYY.MM.DD");var i=e.groupIdList,n=[];i.forEach((function(e){n.push(t.groupData.find((function(t){return t.id===e})).name)})),e.groupNames=n.length?n.join(","):"-"}));var r={totalCount:n.total,pageNo:e.pageNo,data:a};return r})).catch((function(){})).finally((function(){t.onSelectChange([],[])}))},handleAdd:function(){this.modalData={lastPeriod:this.lastPeriod,groupList:this.groupList},this.modalVisible=!0},handleEdit:function(e){if(e);else{if(!this.selectedRowKeys.length)return;e=this.selectedRows[0]}2!==e.status?(this.modalVisible=!0,this.modalData=Object(o["a"])({lastPeriod:this.lastPeriod,groupList:this.groupList},e)):this.$message.error("无法修改已结束的基金诊断配置")},onEditDone:function(){this.confirmLoading=!0,this.$refs.table.refresh(),this.onEditCancel()},onEditCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={};var e=this.$refs.createModal.form;e.resetFields()},handleDelete:function(e){var t=this;this.$confirm({title:"系统提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:function(){t.doDelete(e)},onCancel:function(){}})},doDelete:function(e){var t=this,i=[];if(e)i=[e.userId];else{if(!this.selectedRowKeys.length)return;i=this.selectedRowKeys}u["a"].deleteFundDiagnosisConf({userIds:i}).then((function(e){t.$refs.table.refresh().then((function(){t.onSelectChange([],[])})),t.$message.info("删除成功")}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},resetQueryParams:function(){this.onSelectChange([],[]),this.queryParam={},this.$refs.table.refresh(!0)}}},y=L,R=(i("4a10"),Object(g["a"])(y,n,a,!1,null,"3eba1dcc",null));t["default"]=R.exports},fd34:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return r}));i("b680");var n=["开放中","未开始","已结束"],a=[{title:"期数",dataIndex:"period",customRender:function(e){return e||"-"},minWidth:70},{title:"会员组",dataIndex:"groupNames",customRender:function(e){return e||"-"},minWidth:90,ellipsis:!0},{title:"起止日期",dataIndex:"dateRange",customRender:function(e){return e||"-"},width:210,ellipsis:!0},{title:"本期状态",dataIndex:"status",customRender:function(e){return n[e]||"-"},minWidth:90,ellipsis:!0},{title:"提交持仓人数",dataIndex:"submitNum",customRender:function(e){return e||"-"},minWidth:120,ellipsis:!0},{title:"最大上传数",dataIndex:"fundNumLimit",customRender:function(e){return-1===e?"无限制":e},minWidth:102,ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},minWidth:70}],o=[{title:"上传用户",dataIndex:"nickname",customRender:function(e){return e||"-"},ellipsis:!0},{title:"基金诊断期数",dataIndex:"period",customRender:function(e){return e||"-"},ellipsis:!0},{title:"持仓数量",dataIndex:"fundNum",customRender:function(e){return e||"-"},ellipsis:!0},{title:"总市值",dataIndex:"totalMarketValue",customRender:function(e){return(e/100).toFixed(2)||"-"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},width:190}],r=[{title:"名称",dataIndex:"info",scopedSlots:{customRender:"nameCode"},width:180},{title:"分类",dataIndex:"type",customRender:function(e){return e?e.value:"-"},width:100,ellipsis:!0},{title:"持仓比例",dataIndex:"rate",customRender:function(e){return e||"-"},width:100,ellipsis:!0},{title:"市值",dataIndex:"marketValue",customRender:function(e){return(e/100).toFixed(2)||"-"},width:130,ellipsis:!0},{title:"基金整体评价",dataIndex:"overallEvaluation",customRender:function(e){return e?e.value:"-"},minWidth:260},{title:"操作",scopedSlots:{customRender:"action"},width:120}]}}]);