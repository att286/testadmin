(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9b950d3a"],{8337:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page-header-wrapper",{attrs:{title:!1}},[a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",e._b({},"a-form",e.formLayout,!1),[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"会员编号"}},[a("a-input",{attrs:{"allow-clear":"",placeholder:"请输入","max-length":11},model:{value:e.queryParam.clientId,callback:function(t){e.$set(e.queryParam,"clientId",t)},expression:"queryParam.clientId"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"微信昵称"}},[a("a-input",{attrs:{"allow-clear":"",placeholder:"请输入","max-length":11},model:{value:e.queryParam.nickname,callback:function(t){e.$set(e.queryParam,"nickname",t)},expression:"queryParam.nickname"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"手机号"}},[a("a-input",{attrs:{"allow-clear":"",placeholder:"请输入","max-length":11},model:{value:e.queryParam.mobile,callback:function(t){e.$set(e.queryParam,"mobile",t)},expression:"queryParam.mobile"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"用户类型"}},[a("a-select",{attrs:{"allow-clear":"",placeholder:"请选择"},model:{value:e.queryParam.memberType,callback:function(t){e.$set(e.queryParam,"memberType",t)},expression:"queryParam.memberType"}},[a("a-select-option",{attrs:{value:0}},[e._v("未登录用户")]),a("a-select-option",{attrs:{value:1}},[e._v("已登录用户")])],1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"用户分组"}},[a("a-select",{attrs:{options:e.groupList,"show-search":"","option-filter-prop":"children","allow-clear":"",placeholder:"请选择"},model:{value:e.queryParam.clubGroupId,callback:function(t){e.$set(e.queryParam,"clubGroupId",t)},expression:"queryParam.clubGroupId"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{staticClass:"table-page-search-submitButtons",attrs:{wrapperCol:{offset:3}}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){return e.$refs.table.refresh(!0)}}},[e._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.resetQueryParams}},[e._v("重置")])],1)],1)],1)],1)],1),a("div",{staticClass:"table-operator"},[e.exportEnable?a("a-button",{attrs:{type:"primary",icon:"download",loading:e.exporting},on:{click:function(t){return e.handleDownloadUsers()}}},[e._v("导出用户数据")]):e._e()],1),a("s-table",{ref:"table",attrs:{size:"default",rowKey:"userId",columns:e.columns,data:e.loadData,alert:!1,rowSelection:null,scroll:{x:e.tableX},showPagination:"auto"},scopedSlots:e._u([{key:"avatar",fn:function(e){return a("span",{},[a("a-avatar",{attrs:{size:48,icon:"user",src:e}})],1)}},{key:"available",fn:function(t,r,o,n){return a("span",{},[a("a-switch",{attrs:{loading:o===e.switchIndex,checked:e._f("available")(r,t)},on:{change:function(a){return e.onStatusChange(a,t,r,o,n.dataIndex)}}})],1)}},{key:"group",fn:function(t){return a("span",{},[t.length?e._l(t,(function(t,r){return a("p",{key:r,staticClass:"textOmitted groupInfo",attrs:{title:t}},[e._v(e._s(t))])})):a("p",{staticClass:"groupInfo"},[e._v("-")])],2)}},{key:"action",fn:function(t,r){return a("span",{},[[a("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")])]],2)}}])})],1),a("user-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}}),a("user-edit-group",{ref:"groupModal",attrs:{visible:e.groupModalVisible,loading:e.groupConfirmLoading,model:e.groupModalData},on:{cancel:e.onUpdateGroupCancel,ok:e.onUpdateGroupDone}})],1)},o=[],n=a("1da1"),i=a("2909"),s=a("5530"),l=(a("96cf"),a("159b"),a("d81d"),a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),a("a15b"),a("99af"),a("c1df")),u=a.n(l),c=a("4360"),d=a("4282"),p=a("2af9"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.editType,width:640,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[a("a-spin",{attrs:{spinning:e.spinning}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[void 0!==e.model.userId?a("a-row",{staticStyle:{"margin-bottom":"12px"},attrs:{type:"flex",align:"middle"}},[a("a-col",{attrs:{span:3,offset:2}},[a("a-avatar",{attrs:{size:64,icon:"user"}})],1),a("a-col",{attrs:{span:18}},[a("span",[e._v("微信昵称: "+e._s(e.model.nickname||"-"))])])],1):e._e(),a("a-form-item",e._b({attrs:{label:"用户手机"}},"a-form-item",e.formLayout,!1),[a("a-tooltip",{attrs:{placement:"top",title:e.appUserTip}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile",{initialValue:e.model.mobile,rules:[{required:!0,message:"必填"},{pattern:e.regMobile,message:"请输入11位手机号"}]}],expression:"['mobile', { initialValue: model.mobile, rules: [{ required: true, message: '必填' }, { pattern: regMobile, message:'请输入11位手机号' }] }]"},{name:"input",rawName:"v-input:number",arg:"number"}],attrs:{"allow-clear":"",name:"mobile",placeholder:"请输入用户手机","max-length":11,disabled:e.isAppUser}})],1)],1),a("a-form-item",e._b({attrs:{label:"用户分组"}},"a-form-item",e.formLayout,!1),[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["clubGroupIds",{initialValue:e.model.clubGroupIds,rules:[{required:!0,message:"必填"}]}],expression:"['clubGroupIds', { initialValue: model.clubGroupIds, rules: [{ required: true, message: '必填' }] }]"}],attrs:{name:"clubGroupIds",placeholder:"请选择用户分组","show-search":"","option-filter-prop":"children",options:e.groupList,mode:"multiple"}})],1),a("a-form-item",e._b({attrs:{label:"备注"}},"a-form-item",e.formLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{initialValue:e.model.remark,rules:[{required:!1,message:"必填"}]}],expression:"['remark', { initialValue: model.remark, rules: [{ required: false, message: '必填' }] }]"}],attrs:{"allow-clear":"",name:"remark",placeholder:"请输入备注","auto-size":{minRows:3,maxRows:5},"max-length":e.maxRemarkLen},on:{change:e.handleInputRemark}}),a("span",{staticStyle:{float:"right","line-height":"0px"}},[e._v(e._s(e.curRemarkLen+"/"+e.maxRemarkLen))])],1)],1)],1)],1)},f=[],h=(a("4de4"),a("5319"),a("484f")),b=[],g={name:"UserEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:5}},wrapperCol:{md:{span:18}}},{form:this.$form.createForm(this),spinning:!1,moduleData:[],maxRemarkLen:200,curRemarkLen:0,maxIdLen:10,editType:"添加",userId:"",submitMethod:"",regMobile:h["a"].mobile,isAppUser:!1,appUserTip:"",groupList:[]}},created:function(){var e=this;b.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("visible",(function(t,a){t&&(e.groupList=e.model.groupList.map((function(e){var t=Object(s["a"])({},e);return t.disabled=1===e.isPay,t})),e.groupList=e.groupList.filter((function(e){return-1!==e.value})),"undefined"!==typeof e.model.userId?(e.userId=e.model.userId,e.editType="修改",e.submitMethod="groupUpdateUser",e.model.remark?e.curRemarkLen=e.model.remark.length:e.curRemarkLen=0):(e.userId="",e.editType="添加",e.submitMethod="groupAddUser",e.curRemarkLen=0),1===e.model.memberType?(e.isAppUser=!0,e.appUserTip="已登录用户手机号不支持修改，请删除后重新添加用户"):(e.isAppUser=!1,e.appUserTip=""))}))},mounted:function(){},methods:{handleInputRemark:function(e){this.curRemarkLen=e.target.value.length},handleSubmit:function(e){var t=this;this.form.validateFields((function(e,a){if(!e){for(var r in a)"string"===typeof a[r]&&(a[r]=a[r].replace(h["a"].preWhiteSpace,""));var o={memberUserId:t.userId,mobile:a.mobile,remark:a.remark,clubGroupIds:a.clubGroupIds},n=t.submitMethod;t.spinning=!0,d["a"][n](o).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))}}))}}},v=g,y=a("2877"),w=Object(y["a"])(v,m,f,!1,null,null,null),I=w.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.editType,width:640,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[a("a-spin",{attrs:{spinning:e.spinning}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",e._b({attrs:{label:"用户分组"}},"a-form-item",e.formLayout,!1),[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["clubGroupIds",{initialValue:e.model.clubGroupIds,rules:[{required:!0,message:"必填"}]}],expression:"['clubGroupIds', { initialValue: model.clubGroupIds, rules: [{ required: true, message: '必填' }] }]"}],attrs:{name:"clubGroupIds",placeholder:"请选择用户分组","allow-clear":"","show-search":"","option-filter-prop":"children",options:e.model.groupList}})],1)],1)],1)],1)},k=[],U=[],C={name:"GroupEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:5}},wrapperCol:{md:{span:18}}},{form:this.$form.createForm(this),spinning:!1,editType:"批量修改分组"}},created:function(){var e=this;U.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("visible",(function(e,t){}))},mounted:function(){},methods:{handleSubmit:function(e){var t=this;this.form.validateFields((function(e,a){if(!e){var r={userIds:t.model.userIds,clubGroupId:a.clubGroupIds},o="groupUpdateUsers";t.spinning=!0,d["a"][o](r).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))}}))}}},L=C,$=Object(y["a"])(L,x,k,!1,null,null,null),R=$.exports,G=a("ca00"),D=[{title:"头像",dataIndex:"avatar",scopedSlots:{customRender:"avatar"},width:100,ellipsis:!0},{title:"微信昵称",dataIndex:"nickname",customRender:function(e){return e||"-"}},{title:"手机号",dataIndex:"mobile",customRender:function(e){return e||"-"},ellipsis:!0},{title:"用户分组",dataIndex:"groupInfo",scopedSlots:{customRender:"group"},ellipsis:!0},{title:"管理员权限",dataIndex:"isAdmin",scopedSlots:{customRender:"available"},width:130},{title:"直播间嘉宾",dataIndex:"isGuest",scopedSlots:{customRender:"available"},width:130},{title:"备注",dataIndex:"remark",customRender:function(e){return e||"-"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},width:80}],q={name:"Users",components:{STable:p["c"],UserEdit:I,UserEditGroup:R},data:function(){return this.formLayout={labelCol:{md:{span:7}},wrapperCol:{md:{span:17}}},this.columns=D,{exporting:!1,modalVisible:!1,confirmLoading:!1,modalData:{},groupModalVisible:!1,groupConfirmLoading:!1,groupModalData:{},uploadModalVisible:!1,uploadConfirmLoading:!1,uploadModalData:{},queryParam:{},loadData:this.reqGroupUsers,selectedRowKeys:[],selectedRows:[],groupData:[],groupList:[],uploadingFile:!1,switchIndex:""}},filters:{available:function(e,t){return 1===t}},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.reqGroupData(),e.$refs.table&&e.$refs.table.refresh()})),this.reqUserImportTemplate(),this.reqGroupData()},mounted:function(){},beforeRouteLeave:function(e,t,a){this.$root.eventHub.$off("refreshView"),a()},computed:{tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}},exportEnable:function(){var e=100079===c["a"].getters.taClubId;return e}},methods:{reqUserImportTemplate:function(){var e=this;c["a"].dispatch("ta/GetUserImportTemplate").then((function(t){e.fileColumns=t})).catch((function(){}))},reqGroupData:function(){var e=this;c["a"].dispatch("ta/GetGroups",!0).then((function(t){e.groupData=t,e.groupList=t.map((function(e){return{value:e.id,label:e.name,isPay:e.isPay}}))})).catch((function(e){}))},reqGroupUsers:function(e){var t=this,a=Object(s["a"])(Object(s["a"])({clubGroupId:""},this.queryParam),e),r=this.$route.params.mobile;return r&&(a.mobile=r,delete this.$route.params.mobile),a.date&&(a.serviceExpireStartDate=a.date[0],a.serviceExpireEndDate=a.date[1],delete a.date),d["a"].groupUsers(a).then((function(a){var r=a.result,o=r.groupMemberList;o.forEach((function(e){if(e.groups=[],e.groupIds=[],e.groupNames=[],e.groupInfo=[],e.groupDesc="-",e.userGroupList){var t=e.userGroupList.split(";");t.forEach((function(t){var a=t.split(",");e.groupIds.push(+a[0]),e.groupNames.push(a[1]);var r=a[1];a[2]&&(r=a[1]+" | "+a[2]),e.groupInfo.push(r),e.groups.push({id:+a[0],name:a[1]})})),e.groupDesc=e.groupInfo.join("\n"),e.clubGroupIds=e.groupIds,e.serviceMoment=u()(e.serviceExpire)}})),t.totalUserCnt=r.total;var n={totalCount:r.total,pageNo:e.pageNo,data:o};return n})).catch((function(){})).finally((function(){t.onSelectChange([],[])}))},handleAdd:function(){this.modalData={groupList:this.groupList},this.modalVisible=!0},handleEdit:function(e){if(e);else{if(!this.selectedRowKeys.length)return;e=this.selectedRows[0]}this.modalVisible=!0,this.modalData=Object(s["a"])(Object(s["a"])({},e),{},{groupList:this.groupList})},onUpdateDone:function(){this.confirmLoading=!0,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={};var e=this.$refs.createModal.form;e.resetFields()},handleDelete:function(e){var t=this;e.userId+""!==c["a"].getters.taUid?this.$confirm({title:"系统提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:function(){t.doDelete(e)},onCancel:function(){}}):this.$info({title:"系统提示",content:"不能删除Club主！"})},doDelete:function(e){var t=this,a=[];if(e)a=[e.userId];else{if(!this.selectedRowKeys.length)return;a=this.selectedRowKeys}d["a"].groupDeleteUsers({userIds:a}).then((function(e){t.$refs.table.refresh().then((function(){t.onSelectChange([],[])})),t.$message.info("删除成功")}))},handleEditGroup:function(){var e=this.selectedRowKeys;e.length&&(this.groupModalVisible=!0,this.groupModalData={userIds:e,groupList:this.groupList})},onUpdateGroupDone:function(){this.$refs.table.refresh(),this.onUpdateGroupCancel()},onUpdateGroupCancel:function(){this.groupModalVisible=!1,this.groupConfirmLoading=!1,this.groupModalData={};var e=this.$refs.groupModal.form;e.resetFields()},beforeFileUpload:function(e){var t=e.size/1024/1024<5;return t?(this.handleFileUpload(e),!1):(this.$message.error("上传文件大小不能超过 5MB～"),!1)},onUploadChange:function(e){if("uploading"!==e.file.status){if("error"===e.file.status)return this.uploadingFile=!1,void this.$message.error("上传失败");if("done"===e.file.status){var t=e.file.originFileObj;this.handleFileUpload(t)}}else this.uploadingFile=!0},handleFileUpload:function(e){var t=this;Object(G["j"])(e,(function(a){var r=new FormData;r.append("file",e),t.uploadingFile=!0,d["a"].groupImportUsers(r).then((function(e){t.$refs.table.refresh();var a=e.result.failResult;a&&a.length?t.showUploadResult(a):t.$message.success("用户数据导入成功")})).catch((function(e){})).finally((function(){t.uploadingFile=!1}))}))},showUploadResult:function(e){var t=this,a="失败详情",r=this.$createElement;this.$error({title:"批量导入有误",content:r("div",{},[r("p","部分用户数据上传失败，点击下载失败详情。"),r("a-button",{style:{padding:0},attrs:{type:"link",icon:"link"},on:{click:function(r){var o=[].concat(Object(i["a"])(t.fileColumns),[{title:"失败原因",dataIndex:"failCause"}]);t.createUploadResultFile(e,a,o)}}},"".concat(a,".xlsx"))]),onOk:function(){}})},closeUploadResult:function(){this.uploadModalVisible=!1,this.uploadConfirmLoading=!1,this.uploadModalData={}},createUploadResultFile:function(e,t,a){a||(a=this.fileColumns),e&&Object(G["e"])(t,e,a).then((function(e){})).catch((function(e){}))},handleDownloadTemplate:function(){this.createUploadResultFile([],"导入模版")},handleDownloadUsers:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.totalUserCnt){t.next=3;break}return e.$message.warn("无用户数据"),t.abrupt("return");case 3:return e.exporting=!0,t.next=6,e.reqGroupUsers({pageNo:1,pageSize:e.totalUserCnt});case 6:a=t.sent,e.exporting=!1,r=[{title:"微信昵称",dataIndex:"nickname"},{title:"手机号",dataIndex:"mobile"},{title:"用户分组",dataIndex:"groupInfo"}],e.createUploadResultFile(a.data,"".concat(c["a"].getters.name,"-Club用户列表"),r);case 10:case"end":return t.stop()}}),t)})))()},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},resetQueryParams:function(){this.onSelectChange([],[]),this.queryParam={},this.$refs.table.refresh(!0)},onStatusChange:function(e,t,a,r,o){var n=this;if("isAdmin"!==o||a.userId!==+c["a"].getters.taUid){var i="clubAdminer";"isGuest"===o&&(i="clubGuest"),this.switchIndex=r;var s={targetUserId:a.userId,action:1===a[o]?0:1};d["a"][i](s).then((function(e){a[o]=1===a[o]?0:1,"isAdmin"===o&&n.showSetAdminResult(a[o])})).catch((function(e){})).finally((function(){n.switchIndex=""}))}else this.$info({title:"系统提示",content:"不能对Club主进行操作！"})},showSetAdminResult:function(e){var t=this,a="";a=e?"该用户获得管理员身份，可以协助Club主进行直播相关操作。":"该用户已失去管理员身份，无法协助Club主进行直播相关操作。",this.$success({title:"操作成功",content:a,onOk:function(){t.$refs.table.refresh(!0)}})}}},S=q,_=(a("c981"),Object(y["a"])(S,r,o,!1,null,"1ab5cdaf",null));t["default"]=_.exports},"92b1":function(e,t,a){},c981:function(e,t,a){"use strict";a("92b1")}}]);