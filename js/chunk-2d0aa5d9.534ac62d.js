(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa5d9"],{1169:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("page-header-wrapper",{attrs:{title:!1}},[o("a-layout",{attrs:{id:"components-layout-demo-fixed-sider"}},[o("a-layout-sider",{style:{overflow:"auto",height:"calc(100vh - 137px)",position:"fixed",left:1,background:"white"}},[o("a-row",{staticStyle:{padding:"10px",width:"100%","margin-left":"0px"},attrs:{gutter:8}},[o("a-col",{attrs:{span:19}},[o("a-input-search",{attrs:{"allow-clear":"",placeholder:"查找分组"},on:{change:e.onGroupSearch}})],1),o("a-col",{attrs:{span:5}},[o("a-button",{attrs:{icon:"plus"},on:{click:e.handleAddGroup}})],1)],1),o("a-menu",{attrs:{mode:"inline","selected-keys":[e.selectedGroup]},on:{select:e.onGroupSelect}},e._l(e.groupList,(function(t){return o("a-menu-item",{key:t.id},[o("span",{staticClass:"nav-text"},[e._v(e._s(t.name))])])})),1)],1),o("a-layout",{style:{marginLeft:"212px"}},[o("a-layout-content",{style:{width:"calc(100% - 208px - 24px - 200px - 12px - 24px)",height:"calc(100vh - 137px)",overflow:"auto",background:"white",padding:"24px",position:"fixed",left:1}},[o("div",{staticClass:"table-page-search-wrapper"},[o("a-row",{attrs:{type:"flex",align:"bottom"}},[o("a-col",{attrs:{span:20}},[o("a-descriptions",{attrs:{column:1}},[o("a-descriptions-item",{attrs:{label:"分组名称"}},[e._v(e._s(e.moduleInfo.name))]),o("a-descriptions-item",{attrs:{label:"分组人数"}},[e._v(e._s(e.moduleInfo.total))])],1)],1)],1)],1),o("div",{staticClass:"table-operator"},[o("a-button",{attrs:{type:"primary",icon:"edit"},on:{click:e.handleEditGroup}},[e._v("修改分组信息")]),e.selectedGroup!==e.defaultGroup&&1!==e.selectedGroupIsPay?[o("a-button",{attrs:{type:"primary",icon:"delete",disabled:e.selectedGroup===e.defaultGroup},on:{click:e.handleDeleteGroup}},[e._v("删除分组")]),o("a-divider",{staticStyle:{"margin-right":"16px"},attrs:{type:"vertical"}}),o("a-button",{attrs:{type:"primary",icon:"delete",disabled:0===e.selectedRowKeys.length||e.selectedGroup===e.defaultGroup},on:{click:function(t){return e.handleDeleteUser()}}},[e._v("移出用户")])]:e._e(),o("a-input-search",{ref:"search",staticStyle:{position:"absolute",right:"24px",width:"200px"},attrs:{placeholder:"请输入用户手机号","max-length":11,"allow-clear":""},on:{search:e.onUserSearch,pressEnter:e.onUserSearch},model:{value:e.queryParam.mobile,callback:function(t){e.$set(e.queryParam,"mobile",t)},expression:"queryParam.mobile"}})],2),o("s-table",{ref:"table",attrs:{size:"default",rowKey:"userId",columns:e.columns,data:e.loadData,alert:!1,rowSelection:e.rowSelection,showPagination:"auto"},scopedSlots:e._u([{key:"avatar",fn:function(e){return o("span",{},[o("a-avatar",{attrs:{size:48,icon:"user",src:e}})],1)}},{key:"status",fn:function(t,a,n){return o("span",{},[o("a-switch",{attrs:{loading:n===e.switchIndex,checked:e._f("userStatus")(a)},on:{change:function(o){return e.onStatusChange(o,t,a,n)}}})],1)}},{key:"action",fn:function(t,a){return o("span",{},[[o("a",{staticStyle:{color:"#f12323"},attrs:{_disabled:e.selectedGroup===e.defaultGroup||1===e.selectedGroupIsPay},on:{click:function(t){return e.handleDeleteUser(a)}}},[e._v("移出")])]],2)}}])})],1)],1)],1),o("group-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onGroupUpdateCancel,ok:e.onGroupUpdateDone}}),o("group-add-user",{ref:"addUserModal",attrs:{visible:e.userModalVisible,loading:e.userConfirmLoading,model:e.userModalData},on:{cancel:e.onAddUserCancel,ok:e.onAddUserDone}})],1)},n=[],r=o("2909"),s=(o("7db0"),o("4de4"),o("b0c0"),o("a15b"),o("d81d"),o("d3b7"),o("4360")),i=o("4282"),l=o("2af9"),u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-modal",{attrs:{title:e.editType,width:640,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[o("a-spin",{attrs:{spinning:e.spinning}},[o("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[o("a-form-item",e._b({attrs:{label:"分组名称"}},"a-form-item",e.formLayout,!1),[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["groupName",{initialValue:e.model.groupName,rules:[{required:!0,whitespace:!0,message:"必填"}]}],expression:"['groupName', { initialValue: model.groupName, rules: [{ required: true, whitespace: true, message: '必填' }] }]"}],attrs:{"allow-clear":"",name:"groupName",placeholder:"请输入分组名称，最长"+e.maxNameLen+"个字符","max-length":e.maxNameLen,disabled:e.model.default}})],1)],1)],1)],1)},d=[],c=o("5530"),p=(o("3ca3"),o("ddb0"),o("caad"),o("2532"),o("2f62")),m=["groupName","moduleIds"],f={name:"GroupEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:4}},wrapperCol:{md:{span:20}}},{form:this.$form.createForm(this),spinning:!1,moduleData:[],maxNameLen:15,editType:"添加",groupId:"",submitMethod:""}},computed:Object(c["a"])({},Object(p["c"])({modules:function(e){return e.ta.modules}})),created:function(){var e=this;m.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("visible",(function(t,o){if(t){e.model.moduleIds||(e.model.moduleIds=[]),"undefined"!==typeof e.model.groupId?(e.groupId=e.model.groupId,e.editType="修改",e.submitMethod="updateGroup"):(e.groupId="",e.editType="添加",e.submitMethod="addGroup");var a=[];a.push("getModuleData"),e.spinning=!0,Promise.all(a.map((function(t){return e[t]()}))).then((function(t){e.spinning=!1}))}}))},mounted:function(){},methods:{getModuleData:function(){var e=this;return s["a"].dispatch("ta/GetModules").then((function(t){e.moduleData=t.map((function(t){var o=1===t.moduleType;return o&&!e.model.moduleIds.includes(t.moduleId)&&e.model.moduleIds.push(t.moduleId),{label:t.name,value:t.moduleId,checked:o,disabled:o}}))})).catch((function(t){e.$message.error(t.responseDes||t.msg||t.message)}))},handleSubmit:function(e){var t=this;this.form.validateFields((function(e,o){if(!e){var a={clubGroupId:t.groupId,name:o.groupName,moduleIds:o.moduleIds};a.moduleIds=t.model.moduleIds;var n=t.submitMethod;t.spinning=!0,i["a"][n](a).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))}}))},onModulesChange:function(){}}},h=f,g=o("2877"),b=Object(g["a"])(h,u,d,!1,null,null,null),y=b.exports,G=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-modal",{attrs:{title:e.editType,width:840,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,destroyOnClose:!0,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[o("div",{staticClass:"table-operator"},[o("a-input-search",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户手机号","max-length":11,"allow-clear":""},on:{search:e.onUserSearch,pressEnter:e.onUserSearch},model:{value:e.queryParam.mobile,callback:function(t){e.$set(e.queryParam,"mobile",t)},expression:"queryParam.mobile"}})],1),o("s-table",{ref:"table",attrs:{size:"small",rowKey:"userId",columns:e.columns,data:e.loadData,alert:!1,rowSelection:e.rowSelection,showPagination:"auto"},scopedSlots:e._u([{key:"avatar",fn:function(e){return o("span",{},[o("a-avatar",{attrs:{icon:"user",src:e}})],1)}}])})],1)},v=[],I=["未登录用户","已登录用户"],w=[{title:"头像",dataIndex:"avatar",scopedSlots:{customRender:"avatar"},ellipsis:!0},{title:"会员编号",dataIndex:"clientId",customRender:function(e){return e||"-"},ellipsis:!0},{title:"微信昵称",dataIndex:"nickname",customRender:function(e){return e||"-"},ellipsis:!0},{title:"手机号",dataIndex:"mobile",customRender:function(e){return e||"-"},ellipsis:!0},{title:"用户类型",dataIndex:"memberType",customRender:function(e){return I[e]},ellipsis:!0}],x={name:"GroupAddUser",components:{STable:l["c"]},props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.columns=w,{tableVisible:!1,queryParam:{},loadData:this.reqGroupUsers,selectedRowKeys:[],selectedRows:[],spinning:!1,editType:"添加用户"}},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},created:function(){var e=this;this.$watch("visible",(function(t,o){t&&(e.queryParam={},e.tableVisible=!0)}))},mounted:function(){},methods:{reqGroupUsers:function(e){var t=Object.assign({clubGroupId:this.model.defaultGroup},e,this.queryParam);return i["a"].groupUsers(t).then((function(t){var o=t.result,a=o.groupMemberList,n={totalCount:o.total,pageNo:e.pageNo,data:a};return n})).catch((function(){}))},onUserSearch:function(){this.$refs.table.refresh(!0)},handleSubmit:function(e){var t=this,o={clubGroupId:this.model.groupId,userIds:this.selectedRowKeys},a="groupAddUsers";this.spinning=!0,i["a"][a](o).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t}}},D=x,S=Object(g["a"])(D,G,v,!1,null,null,null),k=S.exports,U=0,$=[{title:"头像",dataIndex:"avatar",scopedSlots:{customRender:"avatar"},ellipsis:!0},{title:"微信昵称",dataIndex:"nickname",customRender:function(e){return e||"-"},ellipsis:!0},{title:"手机号",dataIndex:"mobile",customRender:function(e){return e||"-"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"}}],q={name:"Groups",components:{STable:l["c"],GroupEdit:y,GroupAddUser:k},data:function(){return this.columns=$,{modalVisible:!1,confirmLoading:!1,modalData:{},userModalVisible:!1,userConfirmLoading:!1,userModalData:{},queryParam:{},loadData:this.reqGroupUsers,selectedRowKeys:[],selectedRows:[],groupData:[],groupList:[],switchIndex:"",defaultGroup:U,defaultGroups:[U],selectedGroup:U,selectedGroupIsPay:0,moduleInfo:{name:"",total:"",desc:"",moduleList:[]}}},filters:{userStatus:function(e){return"0"===e.status}},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.reqGroupData(1)})),this.reqGroupData(0)},beforeRouteLeave:function(e,t,o){this.$root.eventHub.$off("refreshView"),o()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{reqGroupData:function(e){var t=this;s["a"].dispatch("ta/GetGroups",!0).then((function(o){if(3===e){var a=o.find((function(e){return!t.groupData.find((function(t){return e.id===t.id}))}));t.selectedGroup=a.id,t.selectedGroupIsPay=a.isPay,t.reqGroupModules(),t.$refs.table.refresh(!0)}t.groupData=o,t.groupList=Object(r["a"])(o),t.groupList=t.groupList.filter((function(e){return-1!==e.id})),t.moduleInfo.name=o.find((function(e){return e.id===t.selectedGroup})).name})).catch((function(){})),0===e?(this.selectedGroup=U,this.selectedGroupIsPay=0,this.reqGroupModules()):1===e?(this.reqGroupModules(),this.$refs.table.refresh(!0)):2===e?this.reqGroupModules():4===e&&(this.selectedGroup=U,this.selectedGroupIsPay=0,this.reqGroupModules(),this.$refs.table.refresh())},reqGroupModules:function(){var e=this;i["a"].groupModules({clubGroupId:this.selectedGroup}).then((function(t){var o=t.result,a=o.groupModuleList;e.moduleInfo.moduleList=a,e.moduleInfo.desc=a.map((function(e){return e.name})).join(" | ")})).catch((function(t){e.moduleInfo.moduleList=[],e.moduleInfo.desc="未设置"}))},reqGroupUsers:function(e){var t=this,o=Object.assign({clubGroupId:this.selectedGroup},e,this.queryParam);return i["a"].groupUsers(o).then((function(o){var a=o.result;t.moduleInfo.total=a.total;var n=a.groupMemberList,r={totalCount:a.total,pageNo:e.pageNo,data:n};return r})).catch((function(e){"2012030"===e.code&&(t.moduleInfo.total=0)})).finally((function(){t.onSelectChange([],[])}))},onGroupSelect:function(e){var t=e.key;this.selectedGroup=t;var o=this.groupData.find((function(e){return e.id===t}));this.selectedGroupIsPay=o.isPay,this.moduleInfo.name=o.name,this.reqGroupModules(),this.$refs.table.refresh()},onGroupSearch:function(e){var t=e.target.value;this.groupList=this.groupData.filter((function(e){return e.name.indexOf(t)>-1}))},onUserSearch:function(){this.$refs.table.refresh(!0)},handleAddGroup:function(){this.modalData={},this.modalVisible=!0},handleEditGroup:function(){var e=this.moduleInfo.moduleList.map((function(e){return e.id}));this.modalData={groupId:this.selectedGroup,groupName:this.moduleInfo.name,moduleIds:e,default:this.selectedGroup===U},this.modalVisible=!0},onGroupUpdateDone:function(){var e="undefined"===typeof this.modalData.groupId?3:2;this.reqGroupData(e),this.onGroupUpdateCancel()},onGroupUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={};var e=this.$refs.createModal.form;e.resetFields()},handleDeleteGroup:function(){var e=this,t=this.moduleInfo;this.$confirm({title:"系统提示",content:"分组删除后，其中的用户会被转移到游客组。是否确认删除 ".concat(t.name," 分组？"),okText:"确认",cancelText:"取消",onOk:function(){e.doDeleteGroup(t)},onCancel:function(){}})},doDeleteGroup:function(){var e=this;i["a"].deleteGroup({clubGroupId:this.selectedGroup}).then((function(t){e.reqGroupData(4),e.$message.info("删除成功")}))},handleAddUser:function(){this.userModalData={groupId:this.selectedGroup,defaultGroup:U},this.userModalVisible=!0},onAddUserDone:function(){this.$refs.table.refresh(),this.onAddUserCancel()},onAddUserCancel:function(){this.userModalVisible=!1,this.userConfirmLoading=!1,this.userModalData={}},handleDeleteUser:function(e){var t=this;1!==this.selectedGroupIsPay?this.$confirm({title:"系统提示",content:"是否确认移出？",okText:"确认",cancelText:"取消",onOk:function(){t.doDeleteUser(e)},onCancel:function(){}}):this.$message.error("会员分组用户不可以被移出")},doDeleteUser:function(e){var t=this,o="";if(e)o=[e.userId];else{if(!this.selectedRowKeys.length)return;o=this.selectedRowKeys}var a=U;a=this.selectedGroup,i["a"].groupUpdateUsers({userIds:o,clubGroupId:a}).then((function(e){t.$refs.table.refresh(),t.$message.info("操作成功")}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t}}},C=q,M=Object(g["a"])(C,a,n,!1,null,null,null);t["default"]=M.exports}}]);