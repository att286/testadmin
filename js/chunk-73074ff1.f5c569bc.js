(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73074ff1"],{9521:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-header-wrapper",{attrs:{title:!1}},[a("a-card",{attrs:{bordered:!1}},[a("a-descriptions",{attrs:{column:5}},[a("a-descriptions-item",{attrs:{label:"上架内容"}},[t._v(t._s(t.activeStr))]),a("a-descriptions-item",{attrs:{label:"自动上架"}},[t._v(t._s(t.autoActiveStr))]),a("a-descriptions-item",{attrs:{label:"自动推送"}},[t._v(t._s(t.autoPushStr))]),t.isAutoPush?a("a-descriptions-item",{attrs:{label:"推送时间"}},[t._v(t._s(t.pushTime))]):t._e()],1),a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"新股名称"}},[a("a-input",{attrs:{"allow-clear":"",placeholder:"请输入","max-length":11},model:{value:t.queryParam.stockName,callback:function(e){t.$set(t.queryParam,"stockName",e)},expression:"queryParam.stockName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"上架状态"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:t.queryParam.state,callback:function(e){t.$set(t.queryParam,"state",e)},expression:"queryParam.state"}},[a("a-select-option",{attrs:{value:t.pushState.all.value}},[t._v(t._s(t.pushState.all.label))]),a("a-select-option",{attrs:{value:t.pushState.pushed.value}},[t._v(t._s(t.pushState.pushed.label))]),a("a-select-option",{attrs:{value:t.pushState.expired.value}},[t._v(t._s(t.pushState.expired.label))])],1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{staticClass:"table-page-search-submitButtons",attrs:{wrapperCol:{offset:3}}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:t.resetQueryParams}},[t._v("重置")])],1)],1)],1)],1)],1),a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{type:"primary",icon:"mail",disabled:0===t.selectedRowKeys.length},on:{click:function(e){return t.handleSendReport()}}},[t._v("推送策略")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"setting"},on:{click:function(e){return t.handleEditPush()}}},[t._v("策略设置")])],1),a("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:t.columns,data:t.loadData,alert:!1,rowSelection:t.rowSelection,scroll:{x:t.tableX},showPagination:"auto"},scopedSlots:t._u([{key:"isPushed",fn:function(e,i){return a("span",{},[0===e?a("a-button",{staticStyle:{color:"#1890ff"},attrs:{type:"link",loading:t.pushList.includes(i.id)},on:{click:function(e){return t.handleSendReport(i)}}},[t._v("推送")]):a("p",[t._v(t._s(10===e?"已推送（自动）":"已推送（手动）"))])],1)}},{key:"available",fn:function(e,i,s,n){return a("span",{},[a("a-switch",{attrs:{loading:s===t.switchIndex,checked:t._f("available")(i,e)},on:{change:function(a){return t.onStatusChange(a,e,i,s,n.dataIndex)}}})],1)}},{key:"action",fn:function(e,i){return a("span",{},[a("a",{staticStyle:{color:"#1890ff"},on:{click:function(e){return t.handleEditReport(i)}}},[t._v("编辑")])])}}])})],1),a("report-edit",{ref:"createModal",attrs:{visible:t.modalVisible,loading:t.confirmLoading,model:t.modalData},on:{cancel:t.onUpdateCancel,ok:t.onUpdateDone}}),a("push-setting",{ref:"pushModal",attrs:{visible:t.pushModalVisible,loading:t.pushConfirmLoading,model:t.pushModalData},on:{cancel:t.onUpdatePushCancel,ok:t.onUpdatePushDone}})],1)},s=[],n=a("ade3"),o=a("5530"),r=(a("159b"),a("d3b7"),a("fb6a"),a("4de4"),a("d81d"),a("7db0"),a("99af"),a("a15b"),a("4282")),l=a("2af9"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:t.title,width:640,maskClosable:!1,visible:t.visible,confirmLoading:t.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){t.handleSubmit()},cancel:function(){t.$emit("cancel")}}},[a("a-spin",{attrs:{spinning:t.spinning}},[a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",t._b({attrs:{label:"新股评分"}},"a-form-item",t.formLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["score",{initialValue:t.score,rules:[{required:!0,whitespace:!0,type:"integer",transform:t.transformInputNumber,min:1,max:5,message:"请输入1~5的整数"}]}],expression:"['score', { initialValue: score, rules: [\n            { required: true, whitespace: true, type:'integer', transform: transformInputNumber, min: 1, max: 5, message: '请输入1~5的整数' }\n          ] }]"}],attrs:{"allow-clear":"",name:"score",placeholder:"请输入新股评分，取值1~5"}})],1),a("a-form-item",t._b({attrs:{label:"新股策略"}},"a-form-item",t.formLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["review",{initialValue:t.model.review,rules:[{required:!0,message:"必填"}]}],expression:"['review', { initialValue: model.review, rules: [{ required: true, message: '必填' }] }]"}],attrs:{"allow-clear":"",name:"review",placeholder:"请输入","auto-size":{minRows:3,maxRows:10},"max-length":t.maxRemarkLen},on:{change:t.handleInputRemark}}),a("span",{staticStyle:{float:"right","line-height":"0px"}},[t._v(t._s(t.curRemarkLen+"/"+t.maxRemarkLen))])],1)],1)],1)],1)},c=[],d=(a("caad"),a("2532"),["A股","可转债","REITs","港股"]),h={all:{value:-1,label:"全部"},pushed:{value:10,label:"已上架"},expired:{value:0,label:"未上架"}},m=20;function f(t){var e=[{title:"名称",dataIndex:"stockName",customRender:function(t){return t||"-"},width:120,ellipsis:!0},{title:"类型",dataIndex:"stockType",customRender:function(t){return d[t-1]||"-"},width:90,ellipsis:!0},{title:"申购截止日期",dataIndex:"ipoEndDate",customRender:function(t){return t||"-"},width:130,ellipsis:!0},{title:"评分",dataIndex:"score",customRender:function(t){return t/m||"-"},width:80,ellipsis:!0},{title:"评论",dataIndex:"review",customRender:function(t){return t||"-"},minWidth:120,ellipsis:!0},{title:"推送状态",dataIndex:"isPushed",scopedSlots:{customRender:"isPushed"},width:140},{title:"上架状态",dataIndex:"state",scopedSlots:{customRender:"available"},width:120},{title:"操作",scopedSlots:{customRender:"action"},width:90}];return e}var p=["A股新股策略","可转债新债策略","REITs打新策略","港股新股策略"],v=[["isAActive","isAPush","isAActive"],["isBondActive","isBondPush","isBondActive"],["isReitsActive","isReitsPush","isReitsActive"],["isHkActive","isHkPush","isHkActive"]],b=p.map((function(t,e){var a=v[e];return{value:e,label:t,title:d[e],activeAttr:a[0],pushAttr:a[1],attrs:a}}));function g(t,e){if(e<2){var a=e?"isAutoPush":"isAutoActive";if(!t[a])return"关闭"}var i=b.filter((function(a){return t[a.attrs[e]]}));if(4===i.length)return"全部策略";var s="--";return i.length&&(s=i.map((function(t){return t.title})).join(" | ")),s}function V(t,e){var a=b.filter((function(a){return t[a.attrs[e]]})).map((function(t){return t.value}));return a}function A(t,e){var a={};return b.forEach((function(i){var s=i.attrs[e];t.includes(i.value)?a[s]=1:a[s]=0})),a}var y=[],w={name:"GroupEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:5}},wrapperCol:{md:{span:18}}},{form:this.$form.createForm(this),spinning:!1,editType:0,title:"新股策略",submitMethod:"",maxRemarkLen:2e3,curRemarkLen:0,score:0,transformInputNumber:function(t){var e=+t;return""===t&&(e=NaN),e}}},created:function(){var t=this;y.forEach((function(e){return t.form.getFieldDecorator(e)})),this.$watch("visible",(function(e,a){e&&(t.form.resetFields(),t.submitMethod="updateIpoAnalysis",10===t.model.state?t.editType=1:t.editType=0,t.score=t.model.score/m,t.model.review?t.curRemarkLen=t.model.review.length:t.curRemarkLen=0)}))},mounted:function(){},methods:{handleInputRemark:function(t){this.curRemarkLen=t.target.value.length},handleSubmit:function(t){var e=this;this.form.validateFields((function(t,a){if(!t){var i=a.score,s=a.review,n=!1;if(i===e.score&&s===e.model.review||(n=!0),!n)return void e.$emit("cancel");var o={ipoId:e.model.id,score:i*m,review:s,state:e.model.state},l=e.submitMethod;e.spinning=!0,r["a"][l](o).then((function(t){e.$message.info("操作成功"),e.$emit("ok")})).catch((function(t){})).finally((function(){e.spinning=!1}))}}))}}},P=w,S=a("2877"),k=Object(S["a"])(P,u,c,!1,null,null,null),x=k.exports,R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:t.title,width:720,maskClosable:!1,visible:t.visible,confirmLoading:t.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){t.handleSubmit()},cancel:function(){t.$emit("cancel")}}},[a("a-spin",{attrs:{spinning:t.spinning}},[a("a-form",t._b({attrs:{form:t.form},on:{submit:t.handleSubmit}},"a-form",t.formLayout,!1),[a("a-form-item",{attrs:{label:"上架内容"}},[a("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["activeVal",{initialValue:t.activeVal,rules:[{required:!0,message:"必选"}]}],expression:"['activeVal', { initialValue: activeVal, rules: [{ required: true, message: '必选' }] }]"}],attrs:{options:t.moduleList},on:{change:t.onModuleChange}})],1),a("a-divider",{attrs:{dashed:""}}),a("a-form-item",{attrs:{label:"自动上架"}},[a("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["autoActiveVal",{initialValue:t.autoActiveVal,rules:[{required:!1,message:"必选"}]}],expression:"['autoActiveVal', { initialValue: autoActiveVal, rules: [{ required: false, message: '必选' }] }]"}],attrs:{options:t.strategyList},on:{change:t.onActiveChange}})],1),a("a-divider",{attrs:{dashed:""}}),a("a-form-item",{attrs:{label:"自动推送"}},[a("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["pushVal",{initialValue:t.pushVal,rules:[{required:!1,message:"必选"}]}],expression:"['pushVal', { initialValue: pushVal, rules: [{ required: false, message: '必选' }] }]"}],on:{change:t.onPushChange}},t._l(t.strategyList,(function(e,i){return a("a-tooltip",{key:i,attrs:{title:3!==i||e.disabled?"":"港股新股策略更新时间为每日15:00，勾选「港股新股策略」后，栖凤平台一旦接收到港股新股策略，将自动上架港股新股策略并通过已绑定服务号向可用「打新日历」模块的用户推送提醒"}},[a("a-checkbox",{staticClass:"ant-checkbox-group-item",attrs:{value:e.value,disabled:e.disabled}},[t._v(t._s(e.label))])],1)})),1)],1),t.autoPush?a("a-form-item",{attrs:{label:"推送时间"}},[a("a-tooltip",{attrs:{title:t.pushTimeTipStr}},[a("a-time-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["pushTime",{initialValue:t.pushTime,rules:[{required:!0,message:"必填"}]}],expression:"['pushTime', { initialValue: pushTime, rules: [{ required: true, message: '必填' }] }]"}],ref:"pushTime",staticStyle:{width:"130px"},attrs:{placeholder:"请选择时间",format:"HH:mm",valueFormat:"HH:mm","minute-step":5,"disabled-hours":t.disabledTime}})],1)],1):t._e()],1)],1)],1)},T=[],C=[],L="09:30",_={name:"PushSetting",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:4}},wrapperCol:{md:{span:20}}},{form:this.$form.createForm(this),spinning:!1,editType:0,title:"打新策略设置",submitMethod:"",moduleList:[],strategyList:[],autoActive:0,autoPush:0,activeVal:[],autoActiveVal:[],pushVal:[],pushTime:L,pushTimeTipStr:""}},created:function(){var t=this;C.forEach((function(e){return t.form.getFieldDecorator(e)})),this.$watch("visible",(function(e,a){e&&(t.form.resetFields(),t.submitMethod="updateIpoConfig",t.handleModel(),t.getPushRule())}))},mounted:function(){},methods:{getPushRule:function(){var t=this;this.disabledAM=[],this.disabledPM=[],this.disabledHours=[],this.spinning=!0,this.$store.dispatch("ta/DailyStrategyRule",!1).then((function(e){var a=e.isSmsPush,i=e.pushValidBeginTime,s=e.pushValidEndTime;t.smsEnable=a,t.startHour=i.slice(0,2),t.endHour=s.slice(0,2)-1;for(var n=0;n<24;n++)n<t.startHour?t.disabledAM.push(n):n>t.endHour&&t.disabledPM.push(n);t._disabledHours=t.disabledAM.concat(t.disabledPM),t.disabledHours=t._disabledHours,t.pushTimeTip="由于微信平台限制，微信推送可用时间段为".concat(t.startHour,":00:00~").concat(t.endHour,":59:59"),t.pushTimeTipStr=t.pushTimeTip})).catch((function(e){t.$error({title:"数据异常",content:"获取数据异常，请稍后重试",okText:"确认",cancelText:"取消",onOk:function(){t.onCancel()},onCancel:function(){}})})).finally((function(){t.spinning=!1}))},handleModel:function(){this.moduleList=b.map((function(t){return{value:t.value,label:t.label}})),this.strategyList=b.map((function(t){return{value:t.value,label:t.label,disabled:!1}}));var t=this.model,e=t.clubActiveVo,a=t.clubAutoActiveVo,i=t.clubPushVo;this.clubId=a.clubId,this.autoActive=a.isAutoActive||0,this.autoPush=i.isAutoPush||0,this.activeVal=V(e,2),this.autoActiveVal=V(a,0),this.autoActive||(this.autoActiveVal=[]),this.pushVal=V(i,1),this.autoPush||(this.pushVal=[]),this.pushTime=i.autoPushTime||L,this.onModuleChange(this.activeVal)},disabledTime:function(){return this.disabledHours},checkModules:function(t){var e=this,a=this.activeVal;this[t]=this[t].filter((function(t){return a.includes(t)})),this.$nextTick((function(){e.form.setFieldsValue(Object(n["a"])({},t,e[t]))}))},onModuleChange:function(t){this.activeVal=t,this.checkModules("autoActiveVal"),this.checkModules("pushVal"),this.strategyList.forEach((function(e){t.includes(e.value)?e.disabled=!1:e.disabled=!0})),this.autoActive=this.autoActiveVal.length>0,this.autoPush=this.pushVal.length>0},onActiveTypeSwith:function(t){var e=t.target.value;this.autoActive=e},onPushTypeSwith:function(t){var e=t.target.value;this.autoPush=e},onActiveChange:function(t){this.autoActiveVal=t,t.length?this.autoActive=1:this.autoActive=0},onPushChange:function(t){this.pushVal=t,t.length?this.autoPush=1:this.autoPush=0},handleSubmit:function(t){var e=this;this.form.validateFields((function(t,a){if(!t){var i=e.clubId,s={},n={clubId:i,isAutoActive:e.autoActive},o={clubId:i,isAutoPush:e.autoPush},l=A(e.form.getFieldValue("activeVal"),2);if(s=Object.assign(s,l),e.autoActive){var u=A(e.form.getFieldValue("autoActiveVal"),0);n=Object.assign(n,u)}if(e.autoPush){var c=A(e.form.getFieldValue("pushVal"),1);o=Object.assign(o,c),o.autoPushTime=e.form.getFieldValue("pushTime")}var d=e.submitMethod,h={clubActiveVo:s,clubAutoActiveVo:n,clubPushVo:o};e.spinning=!0,r["a"][d](h).then((function(t){e.$message.info("操作成功"),e.$emit("ok",{clubActiveVo:s,clubAutoActiveVo:n,clubPushVo:o})})).catch((function(t){})).finally((function(){e.spinning=!1}))}}))}}},I=_,$=(a("a856"),Object(S["a"])(I,R,T,!1,null,"e264f45a",null)),M=$.exports,q={name:"FundUsers",components:{STable:l["c"],ReportEdit:x,PushSetting:M},data:function(){return this.formLayout={labelCol:{md:{span:7}},wrapperCol:{md:{span:17}}},this.columns=f(),{spinning:!1,modalVisible:!1,confirmLoading:!1,modalData:{},pushModalVisible:!1,pushConfirmLoading:!1,pushModalData:{},queryParam:{state:h.all.value},loadData:this.reqStockList,selectedRowKeys:[],selectedRows:[],switchIndex:"",pushIndex:"",pushState:h,stockData:[],stockList:[],activeStr:"--",autoActiveStr:"--",autoPushStr:"--",isAutoPush:0,pushTime:"08:00",pushList:[]}},filters:{available:function(t,e){return 10===e}},created:function(){var t=this;this.$root.eventHub.$on("refreshView",(function(){t.$refs.table&&t.$refs.table.refresh()}))},beforeRouteLeave:function(t,e,a){this.$root.eventHub.$off("refreshView"),a()},computed:{tableX:function(){var t=0;return this.columns.forEach((function(e){t+=e.width||e.minWidth||0})),t},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{reqStockList:function(t){var e=this,a=Object(o["a"])(Object(o["a"])({state:0},this.queryParam),{},{pageNum:t.pageNo,pageSize:t.pageSize});return-1===a.state&&delete a.state,r["a"].ipoAnalysisList(a).then((function(a){var i=a.result;e.handlePushSettingVO(i);var s=i.stockList,n=void 0===s?[]:s,o=n;o.forEach((function(t){var e=t.isPushed,a=t.state;-1===e&&(0===a?t.isPushed=0:10===a&&(t.isPushed=10))}));var r={totalCount:i.total,pageNo:t.pageNo,data:o};return r})).catch((function(t){})).finally((function(){e.onSelectChange([],[])}))},handlePushSettingVO:function(t){var e=t.clubActiveVo,a=void 0===e?{}:e,i=t.clubAutoActiveVo,s=void 0===i?{}:i,n=t.clubPushVo,o=void 0===n?{}:n;"-"===o.autoPushTime&&(o.autoPushTime=""),this.clubActiveVo=a,this.clubAutoActiveVo=s,this.clubPushVo=o,this.activeStr=g(a,2),this.autoActiveStr=g(s,0),this.autoPushStr=g(o,1);var r=o.isAutoPush,l=o.autoPushTime,u=void 0===l?"":l;this.isAutoPush=r,this.pushTime=u.slice(0,5)},handleEditReport:function(t){t&&(this.modalVisible=!0,this.modalData=Object(o["a"])({},t))},onUpdateDone:function(){this.confirmLoading=!0,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={}},handleEditPush:function(){this.pushModalVisible=!0;var t=this.clubActiveVo,e=this.clubAutoActiveVo,a=this.clubPushVo;this.pushModalData={clubActiveVo:t,clubAutoActiveVo:e,clubPushVo:a}},onUpdatePushDone:function(t){this.handlePushSettingVO(t),this.pushConfirmLoading=!0,this.onUpdatePushCancel()},onUpdatePushCancel:function(){this.pushModalVisible=!1,this.pushConfirmLoading=!1,this.pushModalData={}},handleSendReport:function(t){var e=this,a=[];if(t)a=[t];else{if(!this.selectedRowKeys.length)return;a=this.selectedRows}var i=a.filter((function(t){return 0===t.state}));i.length?this.$error({title:"提示",content:"您选择的有未上架的策略，无法进行推送！"}):(i=a.filter((function(t){return 0!==t.isPushed})),i.length?this.$error({title:"提示",content:"您选择的有已推送过的策略，请勿重复推送！"}):this.$confirm({title:"系统提示",content:"确认要将选中的策略推送给用户吗？（可用「打新日历」模块的用户将收到一条公众号消息推送）",okText:"确认",cancelText:"取消",onOk:function(){e.doSend(t,a)},onCancel:function(){}}))},doSend:function(t,e){var a=this,i=[];if(t)i=[t.id];else{if(!this.selectedRowKeys.length)return;i=this.selectedRowKeys}this.pushList=i,this.spinning=!0,r["a"].pushIpoAnalysis({ipoIdList:i}).then((function(t){if(a.$refs.table.refresh().then((function(){a.onSelectChange([],[])})),t.failIpoIds&&t.failIpoIds.length){var e=a.selectedRows.filter((function(e){return t.failIpoIds.find((function(t){return t===e.id}))})).map((function(t){return t.stockName}));a.$error({title:"提示",content:"".concat(e.join("/"),"推送失败，其他").concat(i.length-e.length,"条推送成功。")})}else a.$message.info("推送成功～")})).catch((function(t){})).finally((function(){a.pushList=[],a.spinning=!1}))},onStatusChange:function(t,e,a,i,s){var o=this;this.switchIndex=i;var l=a.id,u=a.review,c=a.score,d=a[s];d="state"===s?0===d?10:0:0===d?1:0;var h="updateIpoAnalysis",m=Object(n["a"])({ipoId:l,review:u,score:c},s,d);r["a"][h](m).then((function(t){a[s]=d})).catch((function(t){})).finally((function(){o.switchIndex=""}))},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},resetQueryParams:function(){this.onSelectChange([],[]),this.queryParam={state:h.all.value},this.$refs.table.refresh(!0)}}},H=q,E=Object(S["a"])(H,i,s,!1,null,null,null);e["default"]=E.exports},a856:function(t,e,a){"use strict";a("e4d0")},e4d0:function(t,e,a){}}]);