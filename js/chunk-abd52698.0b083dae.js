(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-abd52698"],{"0f7b":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-header-wrapper",{attrs:{title:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-spin",{attrs:{spinning:t.spinning}},[a("a-card",{staticClass:"crTrade"},[a("h3",[t._v(t._s(t.strategyName))]),a("div",{staticClass:"row-between-center"},[a("a-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新增发车记录")]),a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.back()}}},[t._v("返回")])],1),a("s-table",{ref:"table",staticStyle:{"margin-top":"20px"},attrs:{size:"default",bordered:"",rowKey:function(t,e){return e},columns:t.columns,data:t.loadData,alert:!1,rowSelection:null,showPagination:"auto",scroll:{x:t.tableX}},scopedSlots:t._u([{key:"action",fn:function(e,n){return a("span",{},[[n.rowSpan?a("a",{staticStyle:{color:"#F12323"},on:{click:function(e){return t.handleUpdate(n)}}},[t._v("编辑")]):t._e()]],2)}}])})],1)],1)],1),a("edit-cy-trade",{ref:"editTrade",attrs:{loading:t.editLoading,visible:t.editVisible,stockList:t.stockList,model:t.editModel},on:{cancel:t.onEditTradeCancel,ok:t.onEditTradeOk}})],1)},r=[],o=a("5530"),i=(a("159b"),a("99af"),a("b0c0"),a("d81d"),a("d3b7"),a("7db0"),a("2af9")),s=a("0970"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"发车记录",width:560,maskClosable:!1,visible:t.visible,confirmLoading:t.loading,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:t.onOk,cancel:function(){t.$emit("cancel")}}},[a("a-spin",{attrs:{spinning:t.loading}},[a("a-form",t._b({attrs:{form:t.form}},"a-form",t.formLayout,!1),[a("a-form-item",{attrs:{label:"发车说明"}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["tradeExplain",{initialValue:t.model.tradeExplain,rules:[{required:!0,message:"必填"}]}],expression:"['tradeExplain', { initialValue: model.tradeExplain, rules: [{ required: true, message: '必填' }] }]"}],attrs:{name:"tradeExplain",placeholder:"请输入",autoSize:{minRows:3,maxRow:5},showCount:"","allow-clear":""}})],1),t._l(t.stocks,(function(e,n){return a("edit-cy-trade-stock",{key:"stock"+n,ref:"stock"+n,refInFor:!0,attrs:{stockList:t.stockList,model:e,index:n},on:{add:t.onAddStock,delete:t.onDeleteStock}})}))],2)],1)],1)},l=[],d=a("2909"),u=(a("4de4"),a("6062"),a("3ca3"),a("ddb0"),a("ac1f"),a("1276"),a("a434"),a("88bc")),f=a.n(u),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-form",t._b({attrs:{form:t.form}},"a-form",t.formLayout,!1),[a("a-form-item",{attrs:{label:"标的名称"}},[a("div",{staticClass:"row-between-center"},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["stockNameAndCode",{initialValue:t.model.stockNameAndCode,rules:[{whitespace:!0,required:!0,message:"必选"}]}],expression:"['stockNameAndCode', { initialValue: model.stockNameAndCode, rules: [{ whitespace:true, required: true, message: '必选' }] }]"}],attrs:{"allow-clear":"",labelInValue:!1,options:t.stockList,showSearch:"",optionFilterProp:"children",placeholder:"请选择"}}),0===t.index?a("a",{staticStyle:{"margin-left":"60px",width:"160px",color:"#1890ff"},on:{click:t.handleAdd}},[t._v("添加")]):a("a",{staticStyle:{"margin-left":"60px",width:"160px",color:"#F12323"},on:{click:t.handleDelete}},[t._v("删除")])],1)]),a("a-form-item",{attrs:{label:"操作类型"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["tradeType",{initialValue:t.model.tradeType||1,rules:[{required:!0,message:"必选"}]}],expression:"['tradeType', { initialValue: model.tradeType || 1, rules: [{ required: true, message: '必选' }] }]"}]},[a("a-radio",{attrs:{value:1}},[t._v("买入")]),a("a-radio",{attrs:{value:2}},[t._v("卖出")])],1)],1),a("a-form-item",{attrs:{label:"份数"}},[a("template",{slot:"help"},[t.helpTxt?a("span",{staticStyle:{color:"#F12323"}},[t._v(t._s(t.helpTxt))]):t._e()]),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["tradeNum",{initialValue:t.model.tradeNum,rules:[{required:!0,message:"必填"},{validator:t.checkTradeNum}]}],expression:"['tradeNum', { initialValue: model.tradeNum, rules: [{ required: true, message: '必填' },{validator:checkTradeNum}] }]"}],attrs:{name:"tradeNum",placeholder:"请输入，仅限整数数字","allow-clear":""}})],2)],1)},h=[],p=(a("a9e3"),["stockNameAndCode","tradeType","tradeNum"]),y={props:{model:{type:Object,default:function(){}},stockList:{type:Array,default:function(){return[]}},index:{type:Number,default:0}},data:function(){return this.formLayout={labelCol:{md:{span:6},xs:{span:24}},wrapperCol:{md:{span:18},xs:{span:24}}},{form:this.$form.createForm(this),helpTxt:""}},created:function(){var t=this;p.forEach((function(e){return t.form.getFieldDecorator(e)})),this.$watch("model",(function(){t.model&&t.form.setFieldsValue(f()(t.model,p))}))},methods:{checkTradeNum:function(t,e,a){this.helpTxt="",e<=0?(t.message="不能为0或负数",a(new Error("不能为0或负数"))):e>10?(this.helpTxt="当前份数数字较大，请确认是否为填写错误",a()):a()},handleAdd:function(){this.$emit("add")},handleDelete:function(){this.$emit("delete",this.index)}}},b=y,g=a("2877"),v=Object(g["a"])(b,m,h,!1,null,null,null),k=v.exports,w=["tradeExplain"],x={components:{EditCyTradeStock:k},props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}},stockList:{type:Array,default:function(){return[]}}},data:function(){return this.formLayout={labelCol:{md:{span:6},xs:{span:24}},wrapperCol:{md:{span:18},xs:{span:24}}},{form:this.$form.createForm(this),stocks:[]}},computed:{},created:function(){var t=this;window.editCyTrade=this,w.forEach((function(e){return t.form.getFieldDecorator(e)})),this.$watch("model",(function(){if(t.model&&t.form.setFieldsValue(f()(t.model,w)),t.model)if(t.model.tradeDataList){var e=t.model.tradeDataList.map((function(t){return Object.assign({},t,{stockNameAndCode:t.stockName+"@"+t.stockCode})}));t.stocks=e.filter((function(e){return t.stockList.find((function(t){return t.value===e.stockNameAndCode}))}))}else t.stocks=[{}]}))},methods:{onOk:function(){var t=this;this.form.validateFields((function(e,a){if(!e){var n=!1,r=[];if(t.stocks.forEach((function(e,a){var o=t.$refs["stock"+a];o?o[0].form.validateFields((function(t,e){t?n=!0:r.push(e)})):n=!0})),n)return;var o=r.map((function(t){return t.stockNameAndCode}));if(Object(d["a"])(new Set(o)).length<r.length)t.$message.error("标的不能重复，请重新选择标的！");else{var i,s={tradeExplain:a["tradeExplain"]};s.tradeData=r.map((function(t){var e=t.stockNameAndCode.split("@");return{stockName:e[0],stockCode:e[1],tradeType:t.tradeType,tradeNum:t.tradeNum}})),null!==(i=t.model)&&void 0!==i&&i.id&&(s.id=t.model.id),t.$emit("ok",s)}}}))},onAddStock:function(){var t=this.stocks,e=this.stockList;t.length>=e.length?this.$message.error("已达到可添加标的上限！"):this.stocks.push({})},onDeleteStock:function(t){this.stocks.splice(t,1)}}},T=x,N=Object(g["a"])(T,c,l,!1,null,null,null),C=N.exports,L={components:{STable:i["c"],EditCyTrade:C},computed:{tableX:function(){var t=0;return this.columns.forEach((function(e){t+=e.width})),t}},data:function(){var t=this,e=[{title:"发车日期",dataIndex:"updateTime",width:140,customRender:this.rowSpan},{title:"标的名称",dataIndex:"stockName",width:180,customRender:function(t,e){return"".concat(t,"(").concat(e.stockCode,")")}},{title:"操作类型",dataIndex:"tradeType",width:100,align:"center",customCell:function(t){return{style:{color:1===t.tradeType?"#F12323":"#05B353"}}},customRender:function(t){return 1===t?"买入":"卖出"}},{title:"份数",dataIndex:"tradeNum",width:80,customRender:function(t){return"".concat(t,"份")},align:"center"},{title:"发车说明",dataIndex:"tradeExplain",width:340,customRender:this.rowSpan},{title:"操作",width:240,align:"center",bordered:!1,customCell:function(){return{style:{borderRight:"1px solid #e8e8e8",borderBottom:"1px solid #e8e8e8"}}},customRender:function(e,a){var n;return n=2===a.state?t.$createElement("span",{class:"cytrade_action-btn"},[t.$createElement("a",{class:"action-btn-blue",style:"margin-right:10px",on:{click:function(){t.handleNotify(a)}}},"推送发车记录"),t.$createElement("a",{class:"action-btn-blue",style:"margin-right:10px",on:{click:function(){t.handleUpdate(a)}}},"编辑"),t.$createElement("a",{class:"cytrade_action",on:{click:function(){t.handleDelete(a)}}},"删除")]):t.$createElement("div",{class:"action-btn-blue"},"已推送"),{children:n,style:{border:"none"},attrs:{rowSpan:a.rowSpan||0}}}}];return{spinning:!1,title:"",strategyId:"",strategyName:"",tradeList:[],loadData:this.loadTradeList,columns:e,stockList:[],editLoading:!1,editVisible:!1,editModel:{}}},created:function(){window.trade=this;var t=this.$route.params,e=t.name,a=t.id;this.strategyId=a,this.strategyName=e,this.$route.meta.title=e,this.loadStockList()},methods:{loadStockList:function(){var t=this;s["a"].getCyTradeStockList({strategyId:this.strategyId}).then((function(e){t.stockList=e.stockData.map((function(t){return{label:"".concat(t.stockName,"(").concat(t.stockCode,")"),value:"".concat(t.stockName,"@").concat(t.stockCode)}}))})).catch((function(e){t.stockList=[]}))},rowSpan:function(t,e,a){var n={children:t,attrs:{rowSpan:e.rowSpan||0}};return n},loadTradeList:function(t){var e=this,a=Object(o["a"])(Object(o["a"])({},t),{},{strategyId:this.strategyId});return a.pageNum=a.pageNo,delete a.pageNo,s["a"].getCyTradeList(a).then((function(a){e.tradeList=a.infoList;var n={totalCount:a.total,pageNo:t.pageNo,data:e.proxyData(a.infoList)};return n})).catch((function(t){return e.tradeList=[],{totalCount:0,pageNo:1,data:[]}})).finally((function(){}))},proxyData:function(t){var e=[];return t.forEach((function(t){t.tradeDataList.forEach((function(a,n){if(0===n){var r=t.id,o=t.updateTime,i=t.strategyId,s=t.tradeExplain,c=t.state;e.push(Object.assign({},{id:r,updateTime:o,strategyId:i,tradeExplain:s,state:c,rowSpan:t.tradeDataList.length},a))}else e.push(Object.assign({},a))}))})),e},getRecordById:function(t){return this.tradeList.find((function(e){return e.id===t}))},handleUpdate:function(t){var e=t.id,a=this.getRecordById(e);a&&(this.editModel=a,this.editVisible=!0)},handleDelete:function(t){var e=this,a=t.id,n=this.getRecordById(a);n&&this.$confirm({title:"系统提示",content:"确认要删除该记录？删除后将不能恢复。",okText:"确认",cancelText:"取消",onOk:function(){e.doDelete(n)},onCancel:function(){}})},doDelete:function(t){var e=this;this.spinning=!0,s["a"].deleteCyTrade({ids:[t.id]}).then((function(t){e.$message.success("记录已删除！"),e.updateTable()})).catch((function(t){})).finally((function(){e.spinning=!1}))},handleNotify:function(t){var e=this,a=t.id,n=this.getRecordById(a);n&&this.$confirm({title:"系统提示",content:"是否要推送发车记录？确认后发车记录会推送给所有的策略订阅用户，且内容无法删除或修改。",okText:"确认",cancelText:"取消",onOk:function(){e.doNotify(n)},onCancel:function(){}})},doNotify:function(t){var e=this;this.spinning=!0,s["a"].cyTradeNotify({id:t.id}).then((function(t){e.$message.success("发车推送已发出！"),e.updateTable()})).catch((function(t){})).finally((function(){e.spinning=!1}))},handleAdd:function(){this.editModel={},this.editVisible=!0},onEditTradeOk:function(t){var e=this,a=t.id?"updateCyTrade":"createCyTrade";this.editLoading=!0;var n="";t.id?n="记录修改成功！":(t.strategyId=this.strategyId,n="记录创建成功！"),s["a"][a]({info:t}).then((function(t){e.$message.success(n),e.onEditTradeCancel(),e.updateTable()})).catch((function(t){e.$message.error("请求失败")})).finally((function(){e.editLoading=!1}))},onEditTradeCancel:function(){this.editVisible=!1;var t=this.$refs.editTrade.form;t&&t.resetFields()},updateTable:function(){this.$refs.table&&this.$refs.table.refresh(!0)}}},E=L,S=(a("35b7"),Object(g["a"])(E,n,r,!1,null,null,null));e["default"]=S.exports},"2d03":function(t,e,a){},"35b7":function(t,e,a){"use strict";a("2d03")},"88bc":function(t,e,a){(function(e){var a=1/0,n=9007199254740991,r="[object Arguments]",o="[object Function]",i="[object GeneratorFunction]",s="[object Symbol]",c="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,d=c||l||Function("return this")();function u(t,e,a){switch(a.length){case 0:return t.call(e);case 1:return t.call(e,a[0]);case 2:return t.call(e,a[0],a[1]);case 3:return t.call(e,a[0],a[1],a[2])}return t.apply(e,a)}function f(t,e){var a=-1,n=t?t.length:0,r=Array(n);while(++a<n)r[a]=e(t[a],a,t);return r}function m(t,e){var a=-1,n=e.length,r=t.length;while(++a<n)t[r+a]=e[a];return t}var h=Object.prototype,p=h.hasOwnProperty,y=h.toString,b=d.Symbol,g=h.propertyIsEnumerable,v=b?b.isConcatSpreadable:void 0,k=Math.max;function w(t,e,a,n,r){var o=-1,i=t.length;a||(a=C),r||(r=[]);while(++o<i){var s=t[o];e>0&&a(s)?e>1?w(s,e-1,a,n,r):m(r,s):n||(r[r.length]=s)}return r}function x(t,e){return t=Object(t),T(t,e,(function(e,a){return a in t}))}function T(t,e,a){var n=-1,r=e.length,o={};while(++n<r){var i=e[n],s=t[i];a(s,i)&&(o[i]=s)}return o}function N(t,e){return e=k(void 0===e?t.length-1:e,0),function(){var a=arguments,n=-1,r=k(a.length-e,0),o=Array(r);while(++n<r)o[n]=a[e+n];n=-1;var i=Array(e+1);while(++n<e)i[n]=a[n];return i[e]=o,u(t,this,i)}}function C(t){return S(t)||E(t)||!!(v&&t&&t[v])}function L(t){if("string"==typeof t||D(t))return t;var e=t+"";return"0"==e&&1/t==-a?"-0":e}function E(t){return j(t)&&p.call(t,"callee")&&(!g.call(t,"callee")||y.call(t)==r)}var S=Array.isArray;function $(t){return null!=t&&O(t.length)&&!_(t)}function j(t){return I(t)&&$(t)}function _(t){var e=A(t)?y.call(t):"";return e==o||e==i}function O(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}function A(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function I(t){return!!t&&"object"==typeof t}function D(t){return"symbol"==typeof t||I(t)&&y.call(t)==s}var F=N((function(t,e){return null==t?{}:x(t,f(w(e,1),L))}));t.exports=F}).call(this,a("c8ba"))}}]);