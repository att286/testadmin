(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fe349e2c"],{"94a6":function(e,t,n){"use strict";n("d013")},d013:function(e,t,n){},e912:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-spin",{attrs:{spinning:e.spinning}},[n("a-card",{attrs:{bordered:!1}},[n("div",{staticClass:"table-operator"},[n("a-button",{attrs:{type:"primary",icon:"mail",disabled:0===e.selectedRowKeys.length},on:{click:function(t){return e.handleSendReport()}}},[e._v("批量发送报告")])],1),n("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:e.rowSelection,scroll:{x:e.tableX},showPagination:"auto"},scopedSlots:e._u([{key:"action",fn:function(t,i){return n("span",{},[n("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleViewReport(i)}}},[e._v("查看诊断信息")]),n("span",{style:{visibility:10===i.state?"visible":"hidden"}},[n("a-divider",{attrs:{type:"vertical"}}),n("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleSendReport(i)}}},[e._v("发送报告")])],1)])}}])})],1),n("report-viewer",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}})],1)],1)},a=[],o=n("5530"),s=(n("159b"),n("d3b7"),n("7db0"),n("a15b"),n("4282")),r=n("2af9"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:e.title,width:"80%",maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,destroyOnClose:!0,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.$emit("cancel")},cancel:function(){e.$emit("cancel")}}},[n("a-row",{attrs:{type:"flex",align:"bottom"}},[n("a-col",{attrs:{span:20}},[n("a-descriptions",{attrs:{column:2}},[n("a-descriptions-item",{attrs:{label:"基金持仓数量"}},[e._v(e._s(e.summary.fundNum))]),n("a-descriptions-item",{attrs:{label:"基金持仓市值"}},[e._v(e._s(e.summary.totalMarketValue))])],1)],1)],1),n("s-table",{ref:"table",attrs:{size:"small",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:null,scroll:{x:e.tableX},showPagination:!1},scopedSlots:e._u([{key:"nameCode",fn:function(t){return n("span",{},[n("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.name)),n("br"),e._v(e._s(t.code))])])}},{key:"action",fn:function(t,i){return n("span",{},[[n("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleViewReport(i)}}},[e._v("查看诊断信息")])]],2)}}])}),n("report-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}})],1)},d=[],u=(n("b680"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:e.title,width:860,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(){e.handleSubmit()},cancel:function(){e.$emit("cancel")}}},[n("a-spin",{attrs:{spinning:e.spinning}},[n("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},e._l(e.model.diagnosis,(function(t){return n("a-form-item",e._b({key:t.codename,attrs:{label:t.showname}},"a-form-item",e.formLayout,!1),[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.codename,{initialValue:t.value,rules:[{required:!1,message:"必填"}]}],expression:"[item.codename, { initialValue: item.value, rules: [{ required: false, message: '必填' }] }]"}],attrs:{disabled:0===e.editType,"allow-clear":"",name:t.codename,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}}})],1)})),1)],1)],1)}),c=[],f=[],m={name:"GroupEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:5}},wrapperCol:{md:{span:18}}},{form:this.$form.createForm(this),spinning:!1,maxRemarkLen:200,curRemarkLen:0,maxIdLen:10,editType:0,title:"基金诊断结果",submitMethod:""}},created:function(){var e=this;f.forEach((function(t){return e.form.getFieldDecorator(t)})),this.$watch("visible",(function(t,n){t&&(e.submitMethod="updateUserFundResult",10===e.model.state?e.editType=1:e.editType=0)}))},mounted:function(){},methods:{handleInputRemark:function(e){this.curRemarkLen=e.target.value.length},handleSubmit:function(e){var t=this;this.form.validateFields((function(e,n){if(!e){var i=!1,a=[],o=function(e){var o=t.model.diagnosis.find((function(t){return t.codename===e}));o.value!==n[e]&&(i=!0),a.push({codename:e,showname:o.showname,value:n[e]})};for(var r in n)o(r);if(!i)return void t.$emit("cancel");var l={userDiagnosisId:t.model.userDiagnosisId,resultId:t.model.id,diagnosis:a},d=t.submitMethod;t.spinning=!0,s["a"][d](l).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))}}))}}},h=m,p=n("2877"),b=Object(p["a"])(h,u,c,!1,null,null,null),g=b.exports,v=n("fd34"),w={name:"UserFunds",components:{STable:r["c"],ReportEdit:g},props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.columns=v["b"],{tableVisible:!1,modalVisible:!1,confirmLoading:!1,modalData:{},queryParam:{},loadData:this.reqUserFunds,selectedRowKeys:[],selectedRows:[],spinning:!1,editType:0,title:"诊断信息",summary:{fundNum:"-",totalMarketValue:"-",state:30}}},computed:{tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},created:function(){var e=this;this.$watch("visible",(function(t,n){t&&(e.summary={fundNum:"-",totalMarketValue:"-",state:30},e.queryParam={},e.tableVisible=!0)}))},mounted:function(){},methods:{reqUserFunds:function(e){var t=this,n=Object(o["a"])(Object(o["a"])({},this.queryParam),{},{targetUserId:this.model.userId,userDiagnosisId:this.model.id});return s["a"].userFundList(n).then((function(n){var i=n.result,a=i.fundNum,o=i.totalMarketValue,s=i.state,r=i.list;t.summary={fundNum:a,totalMarketValue:(o/100).toFixed(2)+"元",state:s},r.forEach((function(e){e.info={code:e.fundCode,name:e.fundName},e.rate=Math.round(e.marketValue/o*1e4)/100+"%";var t=JSON.parse(e.diagnosis)||[];e.diagnosis=t,t.forEach((function(t){e[t.codename]=t}))}));var l={totalCount:i.total,pageNo:e.pageNo,data:r};return l})).catch((function(){}))},handleViewReport:function(e){if(e);else{if(!this.selectedRowKeys.length)return;e=this.selectedRows[0]}this.modalVisible=!0,this.modalData=Object(o["a"])(Object(o["a"])({},e),{},{userDiagnosisId:this.model.id,state:this.model.state})},onUpdateDone:function(){this.confirmLoading=!0,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={}},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t}}},y=w,R=Object(p["a"])(y,l,d,!1,null,null,null),S=R.exports,k={name:"FundUsers",components:{STable:r["c"],ReportViewer:S},data:function(){return this.formLayout={labelCol:{md:{span:7}},wrapperCol:{md:{span:17}}},this.columns=v["c"],{spinning:!1,modalVisible:!1,confirmLoading:!1,modalData:{},queryParam:{},loadData:this.reqFundUsers,selectedRowKeys:[],selectedRows:[],groupData:[],groupList:[],uploadingFile:!1,switchIndex:""}},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.$refs.table&&e.$refs.table.refresh()}))},beforeRouteLeave:function(e,t,n){this.$root.eventHub.$off("refreshView"),n()},computed:{tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{reqFundUsers:function(e){var t=this,n=Object(o["a"])(Object(o["a"])({},this.queryParam),{},{pageNum:e.pageNo,pageSize:e.pageSize});return s["a"].fundUserList(n).then((function(t){var n=t.result,i=n.list,a={totalCount:n.total,pageNo:e.pageNo,data:i};return a})).catch((function(){})).finally((function(){t.onSelectChange([],[])}))},handleViewReport:function(e){if(e);else{if(!this.selectedRowKeys.length)return;e=this.selectedRows[0]}this.modalVisible=!0,this.modalData=Object(o["a"])({},e)},onUpdateDone:function(){this.confirmLoading=!0,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1,this.modalData={}},handleSendReport:function(e){var t=this;this.$confirm({title:"系统提示",content:"确认要向选中的用户发送基金诊断报告？",okText:"确认",cancelText:"取消",onOk:function(){t.doSend(e)},onCancel:function(){}})},doSend:function(e){var t=this,n=[],i=[];if(e)n=[e.id],i=[e];else{if(!this.selectedRowKeys.length)return;n=this.selectedRowKeys,i=this.selectedRows}s["a"].sendUserFundResult({userDiagnosisIds:n}).then((function(e){var n=e.result.failUserDiagnosisIds||[];if(n.length){var a=[];return n.forEach((function(e){a.push(i.find((function(t){return t.id===e})).nickname)})),a=a.join(","),t.$error({title:"系统提示",content:"以下用户诊断报告发送失败："+a}),void(n.length!==i.length&&t.$refs.table.refresh().then((function(){t.onSelectChange([],[])})))}t.$refs.table.refresh().then((function(){t.onSelectChange([],[])})),t.$message.info("发送成功")}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},resetQueryParams:function(){this.onSelectChange([],[]),this.queryParam={},this.$refs.table.refresh(!0)}}},x=k,C=(n("94a6"),Object(p["a"])(x,i,a,!1,null,"2281489a",null));t["default"]=C.exports},fd34:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));n("b680");var i=["开放中","未开始","已结束"],a=[{title:"期数",dataIndex:"period",customRender:function(e){return e||"-"},minWidth:70},{title:"会员组",dataIndex:"groupNames",customRender:function(e){return e||"-"},minWidth:90,ellipsis:!0},{title:"起止日期",dataIndex:"dateRange",customRender:function(e){return e||"-"},width:210,ellipsis:!0},{title:"本期状态",dataIndex:"status",customRender:function(e){return i[e]||"-"},minWidth:90,ellipsis:!0},{title:"提交持仓人数",dataIndex:"submitNum",customRender:function(e){return e||"-"},minWidth:120,ellipsis:!0},{title:"最大上传数",dataIndex:"fundNumLimit",customRender:function(e){return-1===e?"无限制":e},minWidth:102,ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},minWidth:70}],o=[{title:"上传用户",dataIndex:"nickname",customRender:function(e){return e||"-"},ellipsis:!0},{title:"基金诊断期数",dataIndex:"period",customRender:function(e){return e||"-"},ellipsis:!0},{title:"持仓数量",dataIndex:"fundNum",customRender:function(e){return e||"-"},ellipsis:!0},{title:"总市值",dataIndex:"totalMarketValue",customRender:function(e){return(e/100).toFixed(2)||"-"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},width:190}],s=[{title:"名称",dataIndex:"info",scopedSlots:{customRender:"nameCode"},width:180},{title:"分类",dataIndex:"type",customRender:function(e){return e?e.value:"-"},width:100,ellipsis:!0},{title:"持仓比例",dataIndex:"rate",customRender:function(e){return e||"-"},width:100,ellipsis:!0},{title:"市值",dataIndex:"marketValue",customRender:function(e){return(e/100).toFixed(2)||"-"},width:130,ellipsis:!0},{title:"基金整体评价",dataIndex:"overallEvaluation",customRender:function(e){return e?e.value:"-"},minWidth:260},{title:"操作",scopedSlots:{customRender:"action"},width:120}]}}]);