(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a4f3f"],{"0944":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("page-header-wrapper",{attrs:{title:!1}},[s("a-card",{attrs:{bordered:!1}},[s("div",{staticClass:"table-operator"},[s("a-button",{attrs:{type:"primary",icon:"delete",disabled:0===e.selectedRowKeys.length},on:{click:function(t){return e.handleDelete()}}},[e._v("批量删除")]),s("span",[e._v("有"),s("span",{staticStyle:{color:"#F12323"}},[e._v(e._s(e.unreadCount))]),e._v("条未读消息")])],1),s("s-table",{ref:"table",attrs:{size:"middle",rowKey:"messageId",columns:e.columns,data:e.loadData,alert:!1,rowSelection:e.rowSelection,showPagination:"auto",scroll:{x:1356},customRow:e.customRow},scopedSlots:e._u([{key:"readState",fn:function(t,n){return s("span",{},[s("span",{style:"0"===n.messageReadState?"color:#555555;":"color:#000;font-weight:500;"},[e._v(e._s(t))])])}},{key:"action",fn:function(t,n){return s("span",{},[[s("a",{on:{click:function(t){return e.handleDelete(n)}}},[e._v("删除")])]],2)}}])})],1),s("a-drawer",{attrs:{title:"消息详情",width:"460px",destroyOnClose:!0,visible:e.drawer},on:{close:e.closeDrawer}},[s("div",{ref:"infoBox",staticClass:"infoBox"},[s("div",{staticClass:"column-start-center"},[s("h2",[e._v(e._s(e.messageInfo.messageSubject))]),s("h4",[e._v(e._s(e.messageInfo.messageTime))]),s("div",{domProps:{innerHTML:e._s(e.messageInfo.messageInfo)}})])])])],1)},a=[],o=(s("fb6a"),s("7db0"),s("c1df")),i=s.n(o),r=s("2af9"),c=s("f306"),u=[{title:"消息类型",dataIndex:"messageType",scopedSlots:{customRender:"readState"},ellipsis:!1},{title:"消息主题",dataIndex:"messageSubject",scopedSlots:{customRender:"readState"},ellipsis:!0},{title:"日期",dataIndex:"messageTime",customRender:function(e,t){return i()(e,"yyyy-MM-DD HH:mm:ss").format("yyyy-MM-DD")},scopedSlots:{customRender:"readState"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"}}],l={name:"Message",components:{STable:r["c"]},data:function(){var e=this;return this.columns=u,{confirmLoading:!1,dataList:[],unreadCount:0,queryParam:{},drawer:!1,messageInfo:{},curMessage:null,loadData:function(t){return c["a"].userMessageList({}).then((function(s){var n=e.dataList=s.messageList;return e.unreadCount=s.unreadCount,e.getTableList(t,n)})).catch((function(){}))},selectedRowKeys:[],selectedRows:[]}},watch:{unreadCount:function(e,t){this.$store.dispatch("setNewMsgNum",e)}},filters:{},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.$refs.table&&e.$refs.table.refresh()}))},beforeRouteLeave:function(e,t,s){this.$root.eventHub.$off("refreshView"),s()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{getTableList:function(e,t){var s=e.pageNo,n=e.pageSize,a=(s-1)*n,o=a+n,i=t.slice(a,o);return{totalCount:t.length,data:i,pageNo:+e.pageNo}},handleDelete:function(e){var t,s=this;if(e)t="此操作将永久删除该消息, 是否继续?";else{if(!this.selectedRowKeys.length)return;t="此操作将永久删除已选的".concat(this.selectedRowKeys.length,"条消息, 是否继续?")}this.$confirm({title:"系统提示",content:t,okText:"确认",cancelText:"取消",onOk:function(){s.doDelete(e)},onCancel:function(){}})},doDelete:function(e){var t,s=this;t=e?[e.messageId]:this.selectedRowKeys,this.spinning=!0,c["a"].userMessageDelete({idList:JSON.stringify(t)}).then((function(e){s.spinning=!1,s.drawer&&s.closeDrawer(),s.$refs.table.refresh(),s.$message.success("删除成功")})).catch((function(e){s.spinning=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},customRow:function(e,t){var s=this;return{on:{click:function(){"1"===e.messageReadState?s.readMessage(e):s.showMessageInfo(e)}}}},readMessage:function(e){var t=this,s=e.messageId;c["a"].userMessageRead({messageId:s}).then((function(n){t.unreadCount--,t.dataList.find((function(e){return e.messageId===s})).messageReadState="0",t.showMessageInfo(e)})).catch((function(e){}))},showMessageInfo:function(e){this.curMessage=e,this.showDrawer()},showDrawer:function(){var e=this;this.drawer=!0,this.$nextTick((function(){e.getMessageInfo()}))},closeDrawer:function(){this.drawer=!1},getMessageInfo:function(){var e=this;this.spinning=!0;var t=this.curMessage.messageId;c["a"].userMessageDetails({messageId:t}).then((function(s){e.spinning=!1,e.messageInfo=s,e.messageInfo.messageId=t})).catch((function(t){e.spinning=!1}))},deleteFromInfo:function(){this.curMessage&&this.handleDelete(this.curMessage)}}},d=l,f=s("2877"),h=Object(f["a"])(d,n,a,!1,null,null,null);t["default"]=h.exports}}]);