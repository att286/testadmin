(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10bd8cda"],{"920f":function(e,t,i){"use strict";i("ea62")},e7f3:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-header-wrapper",{attrs:{title:!1}},[i("a-spin",{attrs:{spinning:e.spinning}},[i("a-card",{attrs:{bordered:!1}},[e.allRowKeys.length?i("div",{staticClass:"icon-expand ant-table-row-expand-icon",class:e.expandedAll?"ant-table-row-expanded":"ant-table-row-collapsed",on:{click:e.expandAll}}):e._e(),i("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:null,scroll:{x:e.tableX},showPagination:!1,expandRowByClick:!1,expandedRowKeys:e.expandedRowKeys,expandIcon:e.customExpandIcon},on:{expand:e.onExpand},scopedSlots:e._u([{key:"expandedRowRender",fn:function(t){return i("span",{},[i("a-table",{staticClass:"custom-table",attrs:{size:"default",rowKey:"id",columns:e.subColumns,"data-source":t.teamRelateInfos,pagination:!1,rowClassName:function(e,t){return"custom-row"}},scopedSlots:e._u([{key:"payLink",fn:function(t,n){return i("span",{},[i("a-popover",{attrs:{title:"原价链接"},on:{visibleChange:function(t){return e.onPopoverVisible(t,n)}},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"column-start-center",staticStyle:{position:"relative"}},[i("div",{ref:"linkQrCode"+n.id,style:{width:e.qrSize+"px",height:e.qrSize+"px"}}),i("div",{staticClass:"row-center-center"},[e.clipboardEnable?i("a",{ref:"copyQR"+n.id,staticStyle:{color:"#1890ff","margin-top":"16px","margin-right":"16px"},on:{click:function(t){return e.downloadQR(n,1)}}},[e._v("复制二维码")]):e._e(),i("a",{ref:"downloadQR"+n.id,staticStyle:{color:"#1890ff","margin-top":"16px"},on:{click:function(t){return e.downloadQR(n)}}},[e._v("下载二维码")])]),i("a",{staticStyle:{color:"#1890ff","margin-top":"8px"},attrs:{title:t},on:{click:function(i){return e.onShortTxtClick(t)}}},[e._v("复制链接")])])]},proxy:!0}],null,!0)},[i("a",{staticStyle:{color:"#1890ff"},attrs:{title:t},on:{click:function(t){return t.preventDefault(),e.test(t)}}},[e._v("查看")])])],1)}},{key:"available",fn:function(t,n,a,o){return i("span",{},[i("a-switch",{attrs:{loading:n.teamId+"-"+a===e.switchIndex,checked:e._f("available")(t)},on:{change:function(i){return e.onStatusChange(i,t,n,a,o.dataIndex)}}})],1)}},{key:"action",fn:function(n,a){return i("span",{},[[i("a",{staticStyle:{color:"#1890ff"},on:{click:function(i){return e.handleUpdate(2,t,a)}}},[e._v("编辑")]),i("a-divider",{attrs:{type:"vertical"}}),i("a",{staticStyle:{color:"#f12323"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}],null,!0)})],1)}},{key:"shortTxt",fn:function(t){return i("span",{},[i("a",{staticStyle:{color:"#1890ff"},attrs:{title:t},on:{click:function(i){return e.onShortTxtClick(t)}}},[e._v("点击复制")])])}},{key:"payLink",fn:function(t,n){return i("span",{},[i("a-popover",{attrs:{title:"原价链接"},on:{visibleChange:function(t){return e.onPopoverVisible(t,n)}},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"column-start-center",staticStyle:{position:"relative"}},[i("div",{ref:"linkQrCode"+n.id,style:{width:e.qrSize+"px",height:e.qrSize+"px"}}),i("div",{staticClass:"row-center-center"},[e.clipboardEnable?i("a",{ref:"copyQR"+n.id,staticStyle:{color:"#1890ff","margin-top":"16px","margin-right":"16px"},on:{click:function(t){return e.downloadQR(n,1)}}},[e._v("复制二维码")]):e._e(),i("a",{ref:"downloadQR"+n.id,staticStyle:{color:"#1890ff","margin-top":"16px"},on:{click:function(t){return e.downloadQR(n)}}},[e._v("下载二维码")])]),i("a",{staticStyle:{color:"#1890ff","margin-top":"8px"},attrs:{title:t},on:{click:function(i){return e.onShortTxtClick(t)}}},[e._v("复制链接")])])]},proxy:!0}],null,!0)},[i("a",{staticStyle:{color:"#1890ff"},attrs:{title:t},on:{click:function(t){return t.preventDefault(),e.test(t)}}},[e._v("查看")])])],1)}},{key:"available",fn:function(t,n,a,o){return i("span",{},[i("a-switch",{attrs:{loading:a===e.switchIndex,checked:e._f("available")(t)},on:{change:function(i){return e.onStatusChange(i,t,n,a,o.dataIndex)}}})],1)}},{key:"action",fn:function(t,n){return i("span",{},[[i("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleUpdate(1,n)}}},[e._v("关联会员")])]],2)}}])},[i("span",{attrs:{slot:"customHead_action"},slot:"customHead_action"},[i("a-tooltip",{attrs:{title:"购买会员后，会影响其关联会员的购买价格"}},[i("span",[e._v("操作")]),i("a-icon",{staticStyle:{"margin-left":"6px"},attrs:{type:"question-circle"}})],1)],1)])],1),i("member-edit",{ref:"memberModal",attrs:{visible:1===e.modalVisible,loading:1===e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}}),i("shop-edit",{ref:"couponModal",attrs:{visible:2===e.modalVisible,loading:2===e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}})],1)],1)},a=[],o=i("ade3"),r=i("1da1"),s=(i("96cf"),i("159b"),i("d81d"),i("b0c0"),i("4de4"),i("d3b7"),i("7db0"),i("b680"),i("c740"),i("a434"),i("4360")),c=i("2af9"),l=i("4282"),d=i("ca00"),u=i("10a2"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:e.title,width:640,maskClosable:!1,visible:e.visible,confirmLoading:e.spinning,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:function(t){e.handleSubmit(t)},cancel:function(){e.$emit("cancel")}}},[i("a-spin",{attrs:{spinning:e.spinning}},[i("a-form",e._b({attrs:{form:e.form},on:{submit:e.handleSubmit}},"a-form",e.formLayout,!1),[i("a-form-item",{attrs:{label:"所属会员"}},[i("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["teamId",{initialValue:e.member.id,rules:[{required:!0,message:"必填"}]}],expression:"['teamId', { initialValue: member.id, rules: [{ required: true, message: '必填' }] }]"}],attrs:{placeholder:"请选择",disabled:!!e.member,options:e.allMembers},on:{change:e.onMemberChange}})],1),i("a-form-item",{attrs:{label:"关联会员"}},[i("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["relateTeamId",{initialValue:e.child.relateTeamId,rules:[{required:!0,message:"必填"}]}],expression:"['relateTeamId', { initialValue: child.relateTeamId, rules: [{ required: true, message: '必填' }] }]"}],attrs:{placeholder:"请选择",disabled:!!e.member&&!!e.child.relateTeamId,options:e.childMembers},on:{change:e.onChildChange}})],1),i("a-form-item",{attrs:{label:"划线价"}},[e._v(" "+e._s(e.child.originalPriceStr?e.child.originalPriceStr+"元":"--")+" ")]),i("a-form-item",e._b({attrs:{label:"折扣面值"}},"a-form-item",e.formLayout,!1),[i("a-tooltip",{attrs:{title:e.child.id||e.child.value?"":"【请先选择关联会员】"}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["discountValue",{initialValue:e.discountValue,rules:[{required:!0,whitespace:!0,type:"number",transform:e.transformInputNumber,min:e.discountLimitMin,max:e.discountLimitMax,message:"请输入"+e.discountLimitMin+"~"+e.discountLimitMax+"的数字"}]}],expression:"['discountValue', { initialValue: discountValue, rules: [{ required: true, whitespace: true, type:'number', transform: transformInputNumber, min: discountLimitMin, max: discountLimitMax, message: `请输入${discountLimitMin}~${discountLimitMax}的数字` }] }]"}],attrs:{placeholder:"请输入","allow-clear":"",disabled:!(e.child.id||e.child.value),"addon-before":e.discountTypeStr,"addon-after":e.discountTypeUnit},on:{change:e.onDiscountInput}})],1)],1),i("a-form-item",e._b({attrs:{label:"实付价格"}},"a-form-item",e.formLayout,!1),[i("span",[e._v(e._s(e.discountPriceStr))])]),i("a-form-item",e._b({attrs:{label:"角标文案"}},"a-form-item",e.formLayout,!1),[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["iconDesc",{initialValue:e.child.iconDesc,rules:[{required:!0,whitespace:!0,max:8,message:"请输入长度不大于8的字符"}]}],expression:"['iconDesc', { initialValue: child.iconDesc, rules: [{ required: true, whitespace: true, max: 8, message: '请输入长度不大于8的字符' }] }]"}],attrs:{placeholder:"请输入","allow-clear":""}})],1)],1)],1)],1)},f=[],p=(i("99af"),i("caad"),i("2532"),i("c3ea")),h=p["e"],b={name:"ShopEdit",props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{span:6},wrapperCol:{span:18}},{form:this.$form.createForm(this),spinning:!1,editType:0,title:"关联",submitMethod:"",member:{},child:{},allMembers:[],childMembers:[],couponUseType:p["d"],discountValue:"",discountLimitMin:0,discountLimitMax:0,discountTypeVal:0,discountTypeStr:"",discountTypeUnit:"",discountPrice:"",discountPriceStr:"--",transformInputNumber:function(e){var t=+e;return""===e&&(t=NaN),t}}},computed:{},watch:{"child.originalPrice":function(e){this.calcDiscountPrice()}},created:function(){var e=this;this.$watch("visible",(function(t,i){if(t){e.form.resetFields();var n=e.model,a=n.member,o=void 0===a?{}:a,r=n.child,s=void 0===r?{}:r,c=n.allMembers,l=void 0===c?[]:c,d=o.teamRelateInfos||[];e.member=o,e.child=s,e.allMembers=l.filter((function(e){var t=d.findIndex((function(t){return t.relateTeamId!==s.relateTeamId&&t.relateTeamId===e.value}));return-1===t})),s.id?(e.editType=1,e.title="修改关联会员",e.submitMethod="updateClubTeamRelate"):(e.editType=0,e.title="新增关联会员",e.submitMethod="updateClubTeamRelate"),e.setMemberInfo(),e.setUseTypeAddon(e.discountTypeVal),e.onSelectChange()}}))},mounted:function(){},methods:{setMemberInfo:function(){var e=this.child,t=e.discountType,i=void 0===t?h.cut.value:t,n=e.discountValue;this.discountTypeVal=i,this.discountValue=n,this.discountPrice=n?(n/100).toFixed(2):"",this.child.id&&(Object(d["p"])(n)?i===h.cut.value?this.discountValue=n/100:this.discountValue=n/10:this.discountValue="",this.calcDiscountPrice())},setUseTypeAddon:function(e){var t=this.child.originalPrice;e===h.cut.value?(this.discountTypeStr="直减",this.discountTypeUnit="元",this.discountLimitMin=.01,this.discountLimitMax=(t-1)/100):(this.discountTypeStr="减至",this.discountTypeUnit="折",this.discountLimitMin=.1,this.discountLimitMax=9.9),this.discountValue||(this.discountValue="")},calcDiscountPrice:function(){var e=this;this.$nextTick((function(){var t=e.child.originalPrice,i=e.form.getFieldsValue(["discountValue"]),n=i.discountValue,a=e.discountTypeVal;if(!Object(d["p"])(t)||!Object(d["p"])(n)||!Object(d["p"])(a))return e.discountPrice="",void(e.discountPriceStr="--");if(a===h.cut.value?e.discountPrice=((t-100*n)/100).toFixed(2):e.discountPrice=(t*n/10/100).toFixed(2),(n<e.discountLimitMin||n>e.discountLimitMax)&&(e.discountPrice=""),Object(d["p"])(e.discountPrice)){var o=(100*e.discountPrice/t*10).toFixed(1);e.discountPriceStr="".concat(e.discountPrice,"元（≈").concat(o,"折）")}else e.discountPriceStr="--"}))},handleSubmit:function(e){var t=this;this.form.validateFieldsAndScroll((function(e,i){if(!e){var n=Object.assign({},i),a=t.child.id;a&&(n.id=a),n.discountType=t.discountTypeVal,n.discountType===h.cut.value?n.discountValue*=100:n.discountValue*=10;var o=t.submitMethod,r=n;t.spinning=!0,l["a"][o](r).then((function(e){t.spinning=!1,t.$message.success("操作成功"),t.$emit("ok")})).catch((function(e){t.spinning=!1}))}}))},onMemberChange:function(e){this.member=this.allMembers.find((function(t){return t.value===e})),this.onSelectChange()},onChildChange:function(e){this.child=this.allMembers.find((function(t){return t.value===e}))||{},this.form.setFieldsValue({discountValue:""}),this.onSelectChange(),this.setUseTypeAddon(this.discountTypeVal)},onSelectChange:function(){var e=[this.member.id||this.member.value];this.childMembers=this.allMembers.filter((function(t){return!e.includes(t.value)}))},onDiscountTypeChange:function(e,t){e=e.target.value,this.discountTypeVal=e,this.setUseTypeAddon(e),this.form.setFieldsValue({discountValue:""}),this.discountPrice="",this.discountPriceStr="--"},onDiscountInput:function(e){e.target.value;this.calcDiscountPrice()}}},v=b,y=i("2877"),g=Object(y["a"])(v,m,f,!1,null,null,null),x=g.exports,w={name:"Shop",components:{STable:c["c"],MemberEdit:u["a"],ShopEdit:x},data:function(){return this.columns=p["g"],this.subColumns=p["h"],{spinning:!1,modalVisible:0,confirmLoading:0,modalData:{},queryParam:{},loadData:this.reqListData,selectedRowKeys:[],selectedRows:[],switchIndex:"",qrSize:256,linkQrCodeImgs:{},qrImg:"blob:http://localhost:8000/0c5161e0-43dc-4716-b71d-13ff8ddeae92",clipboardEnable:!!window.ClipboardItem,allRowKeys:[],expandedRowKeys:[],expandedAll:!1}},filters:{available:function(e){return 1===e}},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.$refs.table&&e.$refs.table.refresh()})),this.groupList=[],this.freeGroupList=[],this.allMembers=[],this.memberList=[],this.needUpdateGroup=!1,this.linkQrCodeObjs={}},beforeRouteLeave:function(e,t,i){this.$root.eventHub.$off("refreshView"),i()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}},tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e}},methods:{test:function(){},fakeData:function(){var e={teamInfoList:[{id:91,isOpenPay:1,isRenewal:1,originalPrice:9e4,price:8e4,renewalPrice:7e4,serviceExpireDay:100,payIndexUrl:"https://pmoss.xincaitong.com/taqf/club/10067/member_wxQrCode?1646274579967&x-oss-process=image/resize,w_300,m_lfit",teamName:"测1",teamRelateInfos:[{discountType:20,discountValue:50,iconDesc:"立减",id:10,relateTeamId:92,teamId:91},{discountType:20,discountValue:50,iconDesc:"立减",id:11,relateTeamId:93,teamId:91}]},{id:92,isOpenPay:1,isRenewal:1,originalPrice:9e4,price:8e4,renewalPrice:7e4,serviceExpireDay:100,payIndexUrl:"https://pmoss.xincaitong.com/taqf/club/10067/member_wxQrCode?1646274579967&x-oss-process=image/resize,w_300,m_lfit",teamName:"测2",teamRelateInfos:[{discountType:20,discountValue:50,iconDesc:"立减",id:20,relateTeamId:91,teamId:92},{discountType:20,discountValue:50,iconDesc:"立减",id:21,relateTeamId:93,teamId:92}]},{id:93,isOpenPay:1,isRenewal:1,originalPrice:9e4,price:8e4,renewalPrice:7e4,serviceExpireDay:100,payIndexUrl:"https://pmoss.xincaitong.com/taqf/club/10067/member_wxQrCode?1646274579967&x-oss-process=image/resize,w_300,m_lfit",teamName:"测3",teamRelateInfos:[{discountType:20,discountValue:50,iconDesc:"立减",id:30,relateTeamId:91,teamId:93},{discountType:20,discountValue:50,iconDesc:"立减",id:31,relateTeamId:92,teamId:93}]}]};return e},reqGroupData:function(){var e=this;return s["a"].dispatch("ta/GetGroups",this.needUpdateGroup).then((function(t){e.needUpdateGroup=!1,e.groupList=t.map((function(e){return{value:e.id,label:e.name,isPay:e.isPay}})),e.freeGroupList=e.groupList.filter((function(e){return 0===e.isPay}))})).catch((function(e){}))},reqListData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.reqGroupData();case 2:return n={},i.abrupt("return",l["a"].clubTeamRelateList(n).then((function(i){var n=i.result,a=n.teamInfoList||[];a.forEach((function(e){e.teamRelateInfos&&(e.teamRelateInfos=e.teamRelateInfos.filter((function(e){return a.find((function(t){return t.id===e.relateTeamId}))})));var t=e.originalPrice,i=e.price,n=e.renewalPrice,o=e.teamRelateInfos,r=void 0===o?[]:o;e.originalPriceStr=(t/100).toFixed(2),e.priceStr=(i/100).toFixed(2),e.renewPriceStr=(n/100).toFixed(2),e.relateList=[];var s=r;s.forEach((function(e){var t=a.find((function(t){return t.id===e.relateTeamId})),i=t.teamName,n=t.originalPrice,o=t.payIndexUrl,r=t.serviceExpireDay,s=(n/100).toFixed(2),c=e.discountValue,l=e.discountType;e.teamName=i,e.originalPrice=n,e.originalPriceStr=s,e.payIndexUrl=o,e.serviceExpireDay=r,e.cutValue=0,e.payPrice=0,e.discountStr="",l===p["e"].cut.value?(e.cutValue=(c/100).toFixed(2),e.payPrice=(s-e.cutValue).toFixed(2),e.discountStr=e.cutValue+"元"):l===p["e"].discount.value&&(e.payPrice=(s*c/100).toFixed(2),e.cutValue=s-e.payPrice,e.discountStr=c/10+"折"),e.priceStr=e.payPrice}))})),t.allMembers=a.map((function(e){var t=e.id,i=e.teamName,n=e.originalPrice,a=e.originalPriceStr;return{value:t,label:i,originalPrice:n,originalPriceStr:a}})),t.memberList=a.map((function(e){return e.teamName})),t.allRowKeys=a.filter((function(e){return e.teamRelateInfos})).map((function(e){return e.id})),t.expandedRowKeys=t.expandedRowKeys.filter((function(e){return t.allRowKeys.find((function(t){return t===e}))}));var o={totalCount:n.total,pageNo:e.pageNo,data:a};return o})).catch((function(e){})).finally((function(){t.onSelectChange([],[])})));case 4:case"end":return i.stop()}}),i)})))()},handleUpdate:function(e,t,i){var n=this.groupList,a=this.freeGroupList,o=this.memberList,r=this.allMembers;0===e?(this.modalVisible=1,this.modalData={member:t,groupList:n,freeGroupList:a,memberList:o}):(this.modalVisible=2,this.modalData={member:t,child:i,allMembers:r})},onUpdateDone:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.needUpdateGroup=e,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=0},handleDelete:function(e){var t=this;this.$confirm({title:"系统提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:function(){t.doDelete(e)},onCancel:function(){}})},doDelete:function(e){var t=this;this.spinning=!0;var i={id:e.id};l["a"].deleteClubTeamRelate(i).then((function(e){t.$refs.table.refresh(),t.$message.info("删除成功")})).catch((function(e){})).finally((function(){t.spinning=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},resetQueryParams:function(){this.queryParam={},this.$refs.table.refresh(!0)},onStatusChange:function(e,t,i,n,a){var r=this;this.switchIndex=n;var s=1===t?0:1,c=Object(o["a"])({id:i.id},a,s),d="updateTeamInfo";l["a"][d](c).then((function(e){i[a]=s})).catch((function(e){})).finally((function(){r.switchIndex=""}))},onShortTxtClick:function(e){var t=this;this.$copyText(e).then((function(e){t.$message.success("复制完毕")})).catch((function(e){t.$message.error("复制失败")}))},onPopoverVisible:function(e,t){var i=this;if(e){var n=t.id,a=t.payIndexUrl,o=this.linkQrCodeObjs[n];o||this.$nextTick((function(){var e=i.$refs["linkQrCode"+n];o=i.linkQrCodeObjs[n]=Object(d["d"])(a,i.qrSize,e,o),setTimeout((function(){var t=e.lastChild.src;i.linkQrCodeImgs[n]=Object(d["b"])(t)}),100)}))}},downloadQR:function(e,t){var i=e.id,n=e.teamName,a=this.linkQrCodeImgs[i],r=a.blob,s=a.url;if(window.ClipboardItem&&t)navigator.clipboard.write([new window.ClipboardItem(Object(o["a"])({},r.type,r))]),this.$message.success("二维码已复制");else{var c=this.$refs["downloadQR"+i];c.download="".concat(n,"-原价.png"),c.href=s}},expandAll:function(){this.expandedAll?(this.expandedAll=!1,this.expandedRowKeys=[]):(this.expandedRowKeys=this.allRowKeys,this.expandedAll=!0)},onExpand:function(e,t){var i=this.expandedRowKeys,n=t.id,a=i.findIndex((function(e){return e===n}));e&&-1===a?i.push(n):!e&&a>=0&&i.splice(a,1),i.length===this.allRowKeys.length?this.expandedAll=!0:this.expandedAll=!1},customExpandIcon:function(e){var t=this.$createElement;return e.record&&e.record.teamRelateInfos&&e.record.teamRelateInfos.length?e.expanded?t("div",{class:"ant-table-row-expand-icon ant-table-row-expanded",on:{click:function(t){e.onExpand(e.record,t)}}}):t("div",{class:"ant-table-row-expand-icon ant-table-row-collapsed",on:{click:function(t){e.onExpand(e.record,t)}}}):""}}},I=w,S=(i("920f"),Object(y["a"])(I,n,a,!1,null,"5b0013af",null));t["default"]=S.exports},ea62:function(e,t,i){}}]);