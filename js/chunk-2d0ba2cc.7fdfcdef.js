(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ba2cc"],{"35a5":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("page-header-wrapper",{attrs:{title:!1}},[n("a-spin",{attrs:{spinning:e.spinning}},[n("a-card",{attrs:{bordered:!1}},[n("div",{staticClass:"table-operator"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){return e.handleUpdate()}}},[e._v("添加会员")])],1),n("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:null,scroll:{x:e.tableX},showPagination:!1},scopedSlots:e._u([{key:"shortTxt",fn:function(t){return n("span",{},[n("a",{staticStyle:{color:"#1890ff"},attrs:{title:t},on:{click:function(n){return e.onShortTxtClick(t)}}},[e._v("点击复制")])])}},{key:"payLink",fn:function(t,i){return n("span",{},[n("a-popover",{attrs:{title:"原价链接"},on:{visibleChange:function(t){return e.onPopoverVisible(t,i)}},scopedSlots:e._u([{key:"content",fn:function(){return[n("div",{staticClass:"column-start-center",staticStyle:{position:"relative"}},[n("div",{ref:"linkQrCode"+i.id,style:{width:e.qrSize+"px",height:e.qrSize+"px"}}),n("div",{staticClass:"row-center-center"},[e.clipboardEnable?n("a",{ref:"copyQR"+i.id,staticStyle:{color:"#1890ff","margin-top":"16px","margin-right":"16px"},on:{click:function(t){return e.downloadQR(i,1)}}},[e._v("复制二维码")]):e._e(),n("a",{ref:"downloadQR"+i.id,staticStyle:{color:"#1890ff","margin-top":"16px"},on:{click:function(t){return e.downloadQR(i)}}},[e._v("下载二维码")])]),n("a",{staticStyle:{color:"#1890ff","margin-top":"8px"},attrs:{title:t},on:{click:function(n){return e.onShortTxtClick(t)}}},[e._v("复制链接")])])]},proxy:!0}],null,!0)},[n("a",{staticStyle:{color:"#1890ff"},attrs:{title:t}},[e._v("查看")])])],1)}},{key:"available",fn:function(t,i,r,a){return n("span",{},[n("a-switch",{attrs:{loading:r===e.switchIndex,checked:e._f("available")(t)},on:{change:function(n){return e.onStatusChange(n,t,i,r,a.dataIndex)}}})],1)}},{key:"action",fn:function(t,i){return n("span",{},[[n("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleUpdate(i)}}},[e._v("编辑")]),n("a-divider",{attrs:{type:"vertical"}}),n("a",{staticStyle:{color:"#f12323"},on:{click:function(t){return e.handleDelete(i)}}},[e._v("删除")])]],2)}}])})],1),n("member-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}})],1)],1)},r=[],a=n("ade3"),o=n("5530"),c=n("1da1"),s=(n("96cf"),n("159b"),n("d81d"),n("b0c0"),n("4de4"),n("d3b7"),n("7db0"),n("4360")),u=n("2af9"),l=n("4282"),d=n("ca00"),f=n("10a2"),h=n("c3ea"),p={name:"Members",components:{STable:u["c"],MemberEdit:f["a"]},data:function(){return this.columns=h["f"],{spinning:!1,modalVisible:!1,confirmLoading:!1,modalData:{},queryParam:{},loadData:this.reqListData,selectedRowKeys:[],selectedRows:[],switchIndex:"",qrSize:256,linkQrCodeImgs:{},qrImg:"blob:http://localhost:8000/0c5161e0-43dc-4716-b71d-13ff8ddeae92",clipboardEnable:!!window.ClipboardItem}},filters:{available:function(e){return 1===e}},created:function(){var e=this;this.$root.eventHub.$on("refreshView",(function(){e.$refs.table&&e.$refs.table.refresh()})),this.groupList=[],this.freeGroupList=[],this.memberList=[],this.needUpdateGroup=!1,this.linkQrCodeObjs={}},beforeRouteLeave:function(e,t,n){this.$root.eventHub.$off("refreshView"),n()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}},tableX:function(){var e=0;return this.columns.forEach((function(t){e+=t.width||t.minWidth||0})),e}},methods:{reqGroupData:function(){var e=this;return s["a"].dispatch("ta/GetGroups",this.needUpdateGroup).then((function(t){e.needUpdateGroup=!1,e.groupList=t.map((function(e){return{value:e.id,label:e.name,isPay:e.isPay}})),e.freeGroupList=e.groupList.filter((function(e){return 0===e.isPay}))})).catch((function(e){}))},reqListData:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.reqGroupData();case 2:return i=Object(o["a"])(Object(o["a"])({},t.queryParam),{},{pageNum:e.pageNo,pageSize:e.pageSize}),n.abrupt("return",l["a"].clubTeamList(i).then((function(n){var i=n.result,r=i.teamInfoList;r.forEach((function(e){e.inGroupName=t.getGroupName(e.inGroupId),20===e.recruitType&&(e.serviceExpireDay=0);var n=e.recruitNumLimit;e.limitCountStr=Object(d["p"])(n)?n:"-",n===h["i"]&&(e.limitCountStr="无限制")})),t.memberList=r.map((function(e){return e.teamName}));var a={totalCount:i.total,pageNo:e.pageNo,data:r};return a})).catch((function(e){})).finally((function(){t.onSelectChange([],[])})));case 4:case"end":return n.stop()}}),n)})))()},handleUpdate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.modalVisible=!0,this.modalData={member:e,groupList:this.groupList,freeGroupList:this.freeGroupList,memberList:this.memberList}},onUpdateDone:function(e){this.confirmLoading=!0,this.needUpdateGroup=e,this.$refs.table.refresh(),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.confirmLoading=!1},handleDelete:function(e){var t=this;this.$confirm({title:"系统提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:function(){t.doDelete(e)},onCancel:function(){}})},doDelete:function(e){var t=this,n=[];if(e)n=[e.id];else{if(!this.selectedRowKeys.length)return;n=this.selectedRowKeys}n=e.id,this.spinning=!0,l["a"].deleteClubTeam({teamId:n}).then((function(e){t.$refs.table.refresh().then((function(){t.onSelectChange([],[])})),t.$message.info("删除成功")})).catch((function(e){})).finally((function(){t.spinning=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},resetQueryParams:function(){this.queryParam={},this.$refs.table.refresh(!0)},onStatusChange:function(e,t,n,i,r){var o=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var c,s,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("isRecommend"!==r){e.next=7;break}if(!o.recommendObj){e.next=7;break}return e.next=4,new Promise((function(e,t){return o.$confirm({title:"确定要设为推荐吗？",content:"描述描述。",onOk:function(){e(1)},onCancel:function(){e(0)}})}));case 4:if(c=e.sent,c){e.next=7;break}return e.abrupt("return");case 7:o.switchIndex=i,s=1===t?0:1,u=Object(a["a"])({id:n.id},r,s),l["a"].updateTeamInfo(u).then((function(e){n[r]=s})).catch((function(e){})).finally((function(){o.switchIndex=""}));case 11:case"end":return e.stop()}}),e)})))()},onShortTxtClick:function(e){var t=this;this.$copyText(e).then((function(e){t.$message.success("复制完毕")})).catch((function(e){t.$message.error("复制失败")}))},onPopoverVisible:function(e,t){var n=this;if(e){var i=t.id,r=t.payIndexUrl,a=this.linkQrCodeObjs[i];a||this.$nextTick((function(){var e=n.$refs["linkQrCode"+i];a=n.linkQrCodeObjs[i]=Object(d["d"])(r,n.qrSize,e,a),setTimeout((function(){var t=e.lastChild.src;n.linkQrCodeImgs[i]=Object(d["b"])(t)}),100)}))}},downloadQR:function(e,t){var n=e.id,i=e.teamName,r=this.linkQrCodeImgs[n],o=r.blob,c=r.url;if(window.ClipboardItem&&t)navigator.clipboard.write([new window.ClipboardItem(Object(a["a"])({},o.type,o))]),this.$message.success("二维码已复制");else{var s=this.$refs["downloadQR"+n];s.download="".concat(i,"-原价.png"),s.href=c}},getGroupName:function(e){if(!e)return"-";var t=this.groupList.find((function(t){return t.value===e}))||{};return t.label},gotoService:function(e){this.$router.push({name:"GroupService",params:e})},gotoPay:function(e){this.$router.push({name:"GroupPay",params:e})}}},m=p,b=n("2877"),g=Object(b["a"])(m,i,r,!1,null,null,null);t["default"]=g.exports}}]);