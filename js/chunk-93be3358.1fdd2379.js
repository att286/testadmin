(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-93be3358"],{"28cb":function(e,t,i){"use strict";i("5795")},"4c43":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page-header-wrapper",{attrs:{title:!1}},[i("a-card",{attrs:{bordered:!1}},[i("div",{staticClass:"table-page-search-wrapper"},[i("a-row",{attrs:{type:"flex",align:"bottom"}},[i("a-col",{attrs:{span:20}},[i("a-descriptions",{attrs:{column:1}},[i("a-descriptions-item",{attrs:{label:"课程名称"}},[e._v(e._s(e.moduleInfo.contentMap.title))]),i("a-descriptions-item",{attrs:{label:"课程权限"}},[i("a-tooltip",{attrs:{placement:"top",title:e.moduleGroups}},[i("span",[e._v(e._s(e.moduleGroups))])])],1)],1)],1)],1)],1),i("div",{staticClass:"table-operator"},[i("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleEdit}},[e._v("新增课程章节")])],1),i("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,alert:!1,rowSelection:e.rowSelection,showPagination:"auto"},scopedSlots:e._u([{key:"avatar",fn:function(e){return i("span",{},[i("a-avatar",{attrs:{size:48,icon:"user",src:e}})],1)}},{key:"status",fn:function(t,a,n){return i("span",{},[i("a-switch",{attrs:{loading:n===e.switchIndex,checked:e._f("userStatus")(a)},on:{change:function(i){return e.onStatusChange(i,t,a,n)}}})],1)}},{key:"action",fn:function(t,a){return i("span",{},[[i("a",{staticStyle:{color:"#1890ff"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),i("a-divider",{attrs:{type:"vertical"}}),i("a",{staticStyle:{color:"#f12323"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}])})],1),i("chapter-edit",{ref:"createModal",attrs:{visible:e.modalVisible,loading:e.confirmLoading,model:e.modalData},on:{cancel:e.onUpdateCancel,ok:e.onUpdateDone}})],1)},n=[],o=i("5530"),r=(i("b64b"),i("ac1f"),i("5319"),i("d81d"),i("b0c0"),i("a15b"),i("d3b7"),i("4282")),s=i("2af9"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:e.title,width:740,maskClosable:!1,visible:e.visible,confirmLoading:e.loading,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto"}},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[i("a-spin",{attrs:{spinning:e.spinning}},[i("a-form",e._b({attrs:{form:e.form}},"a-form",e.formLayout,!1),[i("a-form-item",{attrs:{label:"章节标题"}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{initialValue:e.model.title,rules:[{required:!0,whitespace:!0,message:"必填"}]}],expression:"['title', { initialValue: model.title, rules:[{ required: true, whitespace: true, message: '必填' }] }]"}],ref:"title",attrs:{"allow-clear":"",maxLength:30,placeholder:"请输入"}})],1),i("a-form-item",{attrs:{label:"章节内容"}},[i("a-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[i("div",{staticClass:"replay-container",staticStyle:{display:"flex","align-items":"center"}},[i("a-tooltip",{attrs:{title:e.uploadTip}},[i("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["url",{initialValue:e.model.url,rules:[{required:!1,message:"必填"}]}],expression:"['url', { initialValue: model.url, rules: [{ required: false, message: '必填' }] }]"}],attrs:{accept:e.acceptType,"file-list":e.fileList,customRequest:function(t){e.customUploadRequest(t)},remove:function(t){e.handleRemoveFile(t)},disabled:null!==e.uploader}},[i("a-button",{attrs:{icon:"upload"}},[e._v(" 上传文件 ")])],1)],1)],1),e.modify?i("a-button",{staticStyle:{padding:"0 6px",color:"#1890ff"},attrs:{type:"link"},on:{click:e.resetUpload}},[e._v("还原文件")]):e._e()],1)],1),i("rich-editor",{ref:"editor",attrs:{visible:e.visible,form:e.form,label:"章节文案",exId:"intro",options:{},contents:e.model.intro}}),i("a-form-item",{attrs:{label:"是否上架"}},[i("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["isActive",{initialValue:e.model.isActive||0,rules:[{required:!0,message:"必选"}]}],expression:"['isActive', { initialValue: model.isActive || 0, rules: [{ required: true, message: '必选' }] }]"}]},[i("a-radio",{attrs:{value:1}},[e._v("是")]),i("a-radio",{attrs:{value:0}},[e._v("否")])],1)],1),i("a-form-item",{attrs:{label:"顺序编号"}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["sortValue",{initialValue:e.sortValue,rules:[{required:!0,whitespace:!0,message:"必填"}]}],expression:"['sortValue', { initialValue: sortValue, rules:[{ required: true, whitespace: true, message: '必填'}] }]"},{name:"input",rawName:"v-input:number",arg:"number"}],attrs:{"allow-clear":"",placeholder:"请输入","max-length":5}})],1)],1)],1)],1)},u=[],c=i("b85c"),d=(i("99af"),i("3ca3"),i("ddb0"),i("0619")),f=i.n(d),p=500,h=1e3,m={name:"ChapterEdit",components:{RichEditor:s["b"]},props:{visible:{type:Boolean,required:!0},loading:{type:Boolean,default:function(){return!1}},model:{type:Object,default:function(){}}},data:function(){return this.formLayout={labelCol:{md:{span:6},xs:{span:24}},wrapperCol:{md:{span:14},xs:{span:24}}},{form:this.$form.createForm(this),spinning:!1,editType:0,title:"添加",submitMethod:"",chapter:{},fileList:[{uid:"-1",name:"image.png",status:"done",url:"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"}],uploader:null,modify:!1,sortValue:"1",acceptType:".mp4, .3gp, .m3u8, .mp3, .aac, .wav",uploadTip:""}},created:function(){var e=this;this.uploadTip="支持".concat(this.acceptType,"格式文件，音频上限").concat(p,"M，视频上限").concat(h,"M"),this.$watch("visible",(function(t,i){t&&(e.chapter={},e.fileList=[],e.submitMethod="",e.modify=!1,"undefined"!==typeof e.model.id?(e.editType=1,e.title="修改章节信息",e.submitMethod="editCourseChapter",e.sortValue=e.model.sortValue+"",e.model.url&&(e.fileList=[{uid:"-1",name:e.model.fileName||"未命名文件",_url:"",status:"done"}])):(e.editType=0,e.title="添加章节",e.submitMethod="addCourseChapter",e.sortValue=e.model.sortValue+10+""),e.$nextTick((function(){e.$refs.title.focus()})))}))},methods:{initData:function(){var e=this,t=[];t.push("reqChapterInfo"),this.spinning=!0,Promise.all(t.map((function(t){return e[t]()}))).then((function(t){e.spinning=!1}))},reqChapterInfo:function(){var e=this;r["a"].courseChapterInfo().then((function(t){var i=t.result;i.url&&(e.fileList[0]={uid:i.id,name:i.fileName,url:i.url,status:"done"}),e.chapter=i})).catch((function(e){})).finally((function(){}))},reqVodSignature:function(){return r["a"].getVodSignature({appId:"weclub"}).then((function(e){var t=e.result,i=t.vodSignature;return i})).catch((function(e){}))},customUploadRequest:function(e){var t=this,i=e.file,a="",n=0;i.type.indexOf("audio")>-1?(a="音频",n=p):i.type.indexOf("video")>-1&&(a="视频",n=h);var o=i.size/1024/1024;if(o>n)this.$error({title:"错误",content:"".concat(a,"文件大小不能超过 ").concat(n,"MB～")});else{this.$message.loading({content:"正在上传文件，请勿关闭弹窗",duration:0}),i.status="uploading",this.fileList[0]=i;var r=new f.a({getSignature:this.reqVodSignature}),s=r.upload({mediaFile:e.file});s.on("media_progress",(function(t){e.onProgress({percent:100*t.percent},e.file)})),s.done().then((function(a){i.status="done",e.onSuccess(a,e.file),t.fileList[0]._url=a.video.url})).catch((function(t){i.status="error",e.onError(t,null,e.file)})).finally((function(){t.uploader=null,t.modify=!0,t.$message.destroy()})),this.uploader=s}},handleRemoveFile:function(e){this.fileList=[],this.modify=!0},resetUpload:function(){this.model.url?this.fileList[0]={uid:"-1",name:this.model.fileName||"未命名文件",_url:"",status:"done"}:this.fileList=[],this.modify=!1},checkUploadStatus:function(){var e,t="",i=Object(c["a"])(this.fileList);try{for(i.s();!(e=i.n()).done;){var a=e.value;if("uploading"===a.status?t="文件正在上传，请等待上传完毕。":"error"===a.status&&(t="有文件上传失败，请先处理。"),t)break}}catch(n){i.e(n)}finally{i.f()}return!!t&&(this.$warning({title:"注意",content:t}),!0)},cancelUpload:function(e){this.uploader.cancel(),this.uploader=null},handleSubmit:function(e){var t=this;this.checkUploadStatus()||this.form.validateFieldsAndScroll((function(e,i){if(!e){var a={title:i.title,isActive:i.isActive,intro:i.intro,sortValue:i.sortValue};if(0===t.editType?a.contentId=t.model.contentId:1===t.editType&&(a.id=t.model.id),t.fileList.length&&(a.url=t.fileList[0]._url||t.fileList[0].url,a.fileName=t.fileList[0].name),!a.url&&!a.intro)return void t.$message.error("章节内容和章节文章请至少设置一项");var n=t.submitMethod;t.spinning=!0,r["a"][n](a).then((function(e){t.$message.info("操作成功"),t.$emit("ok")})).catch((function(e){})).finally((function(){t.spinning=!1}))}}))},handleCancel:function(){var e=this;this.uploader?this.$confirm({title:"注意",content:"您有文件正在上传，是否确认关闭？",onOk:function(){e.cancelUpload(),e.$emit("cancel")}}):this.$emit("cancel")}}},v=m,g=(i("28cb"),i("2877")),b=Object(g["a"])(v,l,u,!1,null,"d8c8429c",null),y=b.exports,w=0,C=[{title:"章节编号",dataIndex:"sortValue",customRender:function(e){return e||"-"},ellipsis:!0},{title:"章节标题",dataIndex:"title",customRender:function(e){return e||"-"},ellipsis:!0},{title:"启用",dataIndex:"memberType",scopedSlots:{customRender:"status"},ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"}}],S="TACourserInfo",V={name:"ChapterList",components:{STable:s["c"],ChapterEdit:y},data:function(){return this.columns=C,{modalVisible:!1,confirmLoading:!1,modalData:{},loadData:this.reqChapterList,selectedRowKeys:[],selectedRows:[],groupData:[],groupList:[],switchIndex:"",defaultGroup:w,defaultGroups:[w],selectedGroup:w,selectedGroupIsPay:0,moduleInfo:{id:0,isActive:0,contentMap:{},groupList:[]},moduleGroups:""}},filters:{userStatus:function(e){return 1===e.isActive}},created:function(){var e=this;this.lastChapterOrder=0;var t=this.$route.params;Object.keys(t).length||(t=localStorage.getItem(S),t&&(t=JSON.parse(t))),t?(localStorage.setItem(S,JSON.stringify(t)),this.moduleInfo=t,this.moduleGroups=this.getGroupListStr(),this.$root.eventHub.$on("refreshView",(function(){e.$refs.table.refresh(!0)}))):this.$router.replace({name:"TAContent"})},beforeRouteLeave:function(e,t,i){localStorage.removeItem(S),this.$root.eventHub.$off("refreshView"),i()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{getGroupListStr:function(){if(!this.moduleInfo.groupList)return"-";var e=this.moduleInfo.groupList.map((function(e){return e.name}));return e.join(" | ")},reqChapterList:function(e){var t=this,i=Object.assign({contentId:this.moduleInfo.id},e,this.queryParam);return r["a"].courseChapterList(i).then((function(i){var a=i.result,n=a.courseInfoList;n.length&&(t.lastChapterOrder=n[n.length-1].sortValue);var o={totalCount:n.length,pageNo:e.pageNo,data:n};return o})).catch((function(e){})).finally((function(){t.onSelectChange([],[])}))},handleAdd:function(){this.modalData={contentId:this.moduleInfo.id,sortValue:this.lastChapterOrder},this.modalVisible=!0},handleEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.modalData=Object(o["a"])({contentId:this.moduleInfo.id,sortValue:this.lastChapterOrder},e),this.modalVisible=!0},onUpdateDone:function(){this.$refs.table.refresh(!0),this.onUpdateCancel()},onUpdateCancel:function(){this.modalVisible=!1,this.modalData={};var e=this.$refs.createModal.form;e.resetFields()},handleDelete:function(e){var t=this;this.$confirm({title:"系统提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:function(){t.doDelete(e)},onCancel:function(){}})},doDelete:function(e){var t=this,i="";if(e)i=[e.id];else{if(!this.selectedRowKeys.length)return;i=this.selectedRowKeys}r["a"].deleteCourseChapter({ids:i,clubGroupId:w}).then((function(e){t.$refs.table.refresh(),t.$message.info("操作成功")})).catch((function(e){})).finally((function(){}))},onStatusChange:function(e,t,i,a,n){var o=this;this.switchIndex=a;var s=0===i.isActive?1:0,l="editCourseChapter",u={id:i.id,isActive:s};r["a"][l](u).then((function(e){i.isActive=s})).catch((function(e){})).finally((function(){o.switchIndex=""}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t}}},I=V,L=Object(g["a"])(I,a,n,!1,null,null,null);t["default"]=L.exports},5795:function(e,t,i){}}]);